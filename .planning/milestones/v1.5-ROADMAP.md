# Milestone v1.5: Interactive REPL

**Status:** SHIPPED 2026-02-18
**Phases:** 24-28
**Total Plans:** 9

## Overview

A standalone Rust executable providing an interactive REPL with Maple-style syntax, all 79 q-Kangaroo functions, variable assignment, LaTeX output, and save-to-file -- giving researchers a terminal-based Maple replacement for q-series computation.

## Phases

### Phase 24: Parser & AST

**Goal**: Users can type Maple-style expressions and the system correctly parses them into an internal representation
**Depends on**: Nothing (first phase of v1.5; depends only on existing qsym-core)
**Requirements**: PARSE-01, PARSE-02, PARSE-03, PARSE-04
**Plans**: 2 plans

Plans:
- [x] 24-01: Crate scaffold and AST/Token/Error type definitions (2min)
- [x] 24-02: Lexer and Pratt parser with comprehensive tests (3min)

**Details:**
- qsym-cli crate as workspace member with binary target `q-kangaroo`
- Token enum (17 variants) covering full Maple-style grammar
- AstNode enum (10 variants) for parsed expressions
- Pratt parser with correct operator precedence: := < +/- < */ < unary- < ^ < funcall
- Non-associative exponentiation enforcement
- 68 tests (20 type + 12 lexer + 36 parser)

### Phase 25: Evaluator & Function Dispatch

**Goal**: Users can call any of the 79 q-Kangaroo functions by name and see computed series output in the terminal
**Depends on**: Phase 24
**Requirements**: FUNC-01 through FUNC-08, SESS-01, OUT-01
**Plans**: 3 plans

Plans:
- [x] 25-01: Evaluator core, variable environment, parser extension, and text output formatting (7min)
- [x] 25-02: Function dispatch groups 1-4 (q-Pochhammer, partitions, theta, series analysis) (4min)
- [x] 25-03: Function dispatch groups 5-8 (relations, hypergeometric, mock theta/Bailey, identity proving) (9min)

**Details:**
- Value enum with 9 variants (Series, Integer, Rational, List, Dict, Pair, Bool, None, Infinity)
- Full arithmetic dispatch with cross-type promotion (Series + Integer, Integer / Integer -> Rational)
- 81 canonical function names dispatched (79 functional + 2 stubs)
- 16 Maple aliases (case-insensitive) + Levenshtein fuzzy matching
- Panic catching via catch_unwind(AssertUnwindSafe) for qsym-core robustness
- 213 tests

### Phase 26: REPL Shell & Session

**Goal**: Users have a polished interactive terminal experience with line editing, history, help, and session control
**Depends on**: Phase 25
**Requirements**: REPL-01 through REPL-04, SESS-02, SESS-03
**Plans**: 2 plans

Plans:
- [x] 26-01: Rustyline REPL loop with history, session commands, multi-line input, and error recovery (4min)
- [x] 26-02: Tab completion (functions, commands, variables) and help system (8 categories, 81 functions) (8min)

**Details:**
- rustyline 17.0 with Emacs mode, circular completion, auto history (10k entries)
- Commands: help, quit, exit, clear, set precision N
- Multi-line via paren/bracket-counting Validator
- Tab completion: 81 functions (auto-paren), 5 commands, user variables
- 8-category help system with per-function signature + description + example
- 267 tests

### Phase 27: Output Commands & Polish

**Goal**: Users can extract computed results as LaTeX or save session work to files
**Depends on**: Phase 26
**Requirements**: OUT-02, OUT-03
**Plans**: 1 plan

Plans:
- [x] 27-01: LaTeX output command and save-to-file command (5min)

**Details:**
- format_latex() for all 9 Value variants (FPS-level LaTeX ported from qsym-python)
- latex command (bare for last result, with variable name)
- save command (write format_value plain text to file)
- 294 tests

### Phase 28: Binary Packaging

**Goal**: Researchers can download and run a single executable on Windows or Linux without installing Rust
**Depends on**: Phase 27
**Requirements**: BIN-01, BIN-02
**Plans**: 1 plan

Plans:
- [x] 28-01: Release build configuration and CI workflow for binary artifacts (3min)

**Details:**
- Release profile: LTO + strip + codegen-units=1 (4.5MB -> 1.4MB)
- cli-release.yml: 3 jobs (build-linux, build-windows, create-release)
- Windows binary bundled with 5 MinGW DLLs
- --version flag for CI verification
- 294 tests (no regressions)

---

## Milestone Summary

**Key Decisions:**
- Hand-written Pratt parser (no external parser libraries, only depends on qsym-core + rustyline)
- q is reserved keyword token, not identifier
- Binding powers: := (2,1) < +/- (3,4) < */ (5,6) < unary- (7) < ^ (9,10) < funcall (11)
- Value enum: 9 variants covering all qsym-core output types
- Series + Integer promotes integer to constant FPS (Maple behavior)
- Integer / Integer -> Rational (exact arithmetic)
- Bailey pairs use integer codes in REPL (no string literals)
- prove_nonterminating directs to Python API (requires closure arguments)
- rustyline 17.0 with derive feature; home crate pinned to 0.5.11 for Rust 1.85
- Commands intercepted before parser; := lines always pass through
- format_latex ported from qsym-python FPS-level (not qsym-core Expr-level)
- LTO + strip + codegen-units=1 for optimized binary
- Bundle 5 MinGW DLLs (no static GMP linking)
- Separate cli-release.yml from existing release.yml

**Issues Resolved:**
- home crate 0.5.12 requires Rust 1.88 (pinned to 0.5.11 for Rust 1.85 compatibility)
- rustyline pub(crate) types prevented direct trait testing (extracted pure functions)
- Binary silently fails without MinGW DLLs in PATH (CI bundles DLLs in zip)
- ASCII kangaroo banner art updated to full-body recognizable kangaroo

**Issues Deferred:**
- prove_nonterminating requires closure arguments (Python-only, informative error in REPL)
- Static GMP linking on Windows (separate build system change)
- macOS binary (no macOS CI)

**Technical Debt Incurred:**
- None significant

---

_For current project status, see .planning/ROADMAP.md_
