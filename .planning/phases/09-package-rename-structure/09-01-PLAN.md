---
phase: 09-package-rename-structure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crates/qsym-python/Cargo.toml
  - crates/qsym-python/pyproject.toml
  - crates/qsym-python/src/lib.rs
  - crates/qsym-python/python/q_kangaroo/__init__.py
  - crates/qsym-python/tests/test_integration.py
autonomous: true

must_haves:
  truths:
    - "The Rust workspace compiles with the new _q_kangaroo lib name (cargo test passes)"
    - "The Python package directory is named q_kangaroo (not qsymbolic)"
    - "The triple-match rule holds: Cargo.toml [lib] name, pyproject.toml module-name, and lib.rs #[pymodule] fn all reference _q_kangaroo"
    - "All 9 import lines in test_integration.py reference q_kangaroo"
    - "No source file in crates/ contains the string qsymbolic"
  artifacts:
    - path: "crates/qsym-python/Cargo.toml"
      provides: "Rust cdylib named _q_kangaroo"
      contains: 'name = "_q_kangaroo"'
    - path: "crates/qsym-python/pyproject.toml"
      provides: "PyPI package name q-kangaroo with correct module-name"
      contains: 'name = "q-kangaroo"'
    - path: "crates/qsym-python/src/lib.rs"
      provides: "PyO3 module entry point named _q_kangaroo"
      contains: "fn _q_kangaroo"
    - path: "crates/qsym-python/python/q_kangaroo/__init__.py"
      provides: "Python package re-exporting from q_kangaroo._q_kangaroo"
      contains: "from q_kangaroo._q_kangaroo import"
    - path: "crates/qsym-python/tests/test_integration.py"
      provides: "Integration tests importing from q_kangaroo"
      contains: "from q_kangaroo import"
  key_links:
    - from: "crates/qsym-python/Cargo.toml"
      to: "crates/qsym-python/src/lib.rs"
      via: "[lib] name must match #[pymodule] fn name"
      pattern: "_q_kangaroo"
    - from: "crates/qsym-python/pyproject.toml"
      to: "crates/qsym-python/Cargo.toml"
      via: "module-name last component must match [lib] name"
      pattern: "_q_kangaroo"
---

<objective>
Rename the Python-facing package from qsymbolic to q_kangaroo across all source files, config files, and tests, then verify the Rust workspace still compiles and all 578 Rust tests pass.

Purpose: The codebase must use the final public name (q_kangaroo) before PyPI packaging. This plan performs the atomic rename and proves Rust-side correctness.
Output: All 5 source files updated, directory renamed, stale artifacts cleaned, 578 Rust tests passing.
</objective>

<execution_context>
@C:/Users/Owner/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Owner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-package-rename-structure/09-RESEARCH.md
@crates/qsym-python/Cargo.toml
@crates/qsym-python/pyproject.toml
@crates/qsym-python/src/lib.rs
@crates/qsym-python/python/qsymbolic/__init__.py
@crates/qsym-python/tests/test_integration.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename directory and update all source files</name>
  <files>
    crates/qsym-python/Cargo.toml
    crates/qsym-python/pyproject.toml
    crates/qsym-python/src/lib.rs
    crates/qsym-python/python/q_kangaroo/__init__.py
    crates/qsym-python/tests/test_integration.py
  </files>
  <action>
Perform the rename in this exact order:

1. **Directory rename** (filesystem first):
   ```bash
   git mv crates/qsym-python/python/qsymbolic crates/qsym-python/python/q_kangaroo
   ```

2. **Clean stale artifacts** from the renamed directory:
   ```bash
   rm -rf crates/qsym-python/python/q_kangaroo/__pycache__
   rm -f crates/qsym-python/python/q_kangaroo/_qsymbolic*.pyd
   ```

3. **Update crates/qsym-python/Cargo.toml** -- change line 8:
   - FROM: `name = "_qsymbolic"`
   - TO: `name = "_q_kangaroo"`
   - Leave everything else unchanged (package name "qsym-python", dependencies, etc.)

4. **Update crates/qsym-python/pyproject.toml** -- change 2 lines:
   - Line 6: `name = "qsymbolic"` -> `name = "q-kangaroo"` (hyphens for PyPI)
   - Line 14: `module-name = "qsymbolic._qsymbolic"` -> `module-name = "q_kangaroo._q_kangaroo"` (underscores for Python import)

5. **Update crates/qsym-python/src/lib.rs** -- change line 22:
   - FROM: `fn _qsymbolic(m: &Bound<'_, PyModule>) -> PyResult<()> {`
   - TO: `fn _q_kangaroo(m: &Bound<'_, PyModule>) -> PyResult<()> {`
   - Also update the doc comment on line 20 from "The native Python module entry point." to "The native q-Kangaroo Python module entry point."

6. **Update crates/qsym-python/python/q_kangaroo/__init__.py** -- change 3 things:
   - Line 1 docstring: `"""Q-Symbolic: Symbolic computation for q-series.` -> `"""q-Kangaroo: Symbolic computation for q-series.`
   - Line 28: `from qsymbolic._qsymbolic import QSession, QExpr, QSeries, version` -> `from q_kangaroo._q_kangaroo import QSession, QExpr, QSeries, version`
   - Line 32: `from qsymbolic._qsymbolic import (` -> `from q_kangaroo._q_kangaroo import (`

7. **Update crates/qsym-python/tests/test_integration.py** -- change ALL 9 import lines:
   - Line 24: `from qsymbolic import QSession, partition_gf, aqprod` -> `from q_kangaroo import QSession, partition_gf, aqprod`
   - Line 51: `from qsymbolic import QSession, theta3` -> `from q_kangaroo import QSession, theta3`
   - Line 83: `from qsymbolic import QSession, partition_gf, aqprod` -> `from q_kangaroo import QSession, partition_gf, aqprod`
   - Line 109: `from qsymbolic import QSession, etaq, prodmake` -> `from q_kangaroo import QSession, etaq, prodmake`
   - Line 140: `from qsymbolic import QSession` -> `from q_kangaroo import QSession`
   - Line 160: `from qsymbolic import QSession, etaq` -> `from q_kangaroo import QSession, etaq`
   - Line 179: `from qsymbolic import QSession` -> `from q_kangaroo import QSession`
   - Line 217: `from qsymbolic import QSession, distinct_parts_gf, odd_parts_gf` -> `from q_kangaroo import QSession, distinct_parts_gf, odd_parts_gf`
   - Line 243: `from qsymbolic import QSession, phi, try_summation` -> `from q_kangaroo import QSession, phi, try_summation`
   - Also update the module docstring (line 4): `Q-Symbolic Python API` -> `q-Kangaroo Python API`

IMPORTANT: Do NOT rename Rust crate names (qsym-core, qsym-python stay the same). Do NOT change any `use qsym_core::` statements. Only Python-facing names change.
  </action>
  <verify>
Run in order:
1. `grep -r "qsymbolic" --include="*.py" --include="*.rs" --include="*.toml" crates/` should return NO matches
2. `ls crates/qsym-python/python/q_kangaroo/__init__.py` should exist
3. `ls crates/qsym-python/python/qsymbolic/` should fail (directory should not exist)
  </verify>
  <done>All 5 source files contain only the new name (q_kangaroo/_q_kangaroo), the directory is renamed, and grep confirms zero occurrences of "qsymbolic" in crates/ source files.</done>
</task>

<task type="auto">
  <name>Task 2: Verify Rust compilation and all 578 tests pass</name>
  <files></files>
  <action>
Run the full Rust test suite to prove the rename did not break any Rust-side functionality. The [lib] name change in Cargo.toml affects the cdylib output name but should not affect any Rust test compilation or execution.

```bash
export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH"
cargo test --workspace
```

This must produce 578+ test results with 0 failures. The workspace includes both qsym-core (pure Rust tests) and qsym-python (cdylib build check).

If any test fails, the rename introduced a regression -- investigate immediately. The only expected change is the output artifact name from `_qsymbolic.dll` to `_q_kangaroo.dll`.

Also verify Cargo.lock was updated correctly:
```bash
cargo check -p qsym-python
```
  </action>
  <verify>
`cargo test --workspace` output shows:
- "test result: ok" for all test crates
- 578+ tests passed, 0 failed
  </verify>
  <done>All 578 Rust tests pass. cargo check -p qsym-python succeeds. The rename is Rust-verified.</done>
</task>

</tasks>

<verification>
1. `grep -r "qsymbolic" --include="*.py" --include="*.rs" --include="*.toml" crates/` returns no matches
2. Directory `crates/qsym-python/python/q_kangaroo/` exists with `__init__.py`
3. Directory `crates/qsym-python/python/qsymbolic/` does not exist
4. `cargo test --workspace` passes all 578 tests
5. Triple-match verified: Cargo.toml, pyproject.toml, and lib.rs all agree on `_q_kangaroo`
</verification>

<success_criteria>
- All 5 source files updated with new names
- Python package directory renamed from qsymbolic/ to q_kangaroo/
- Zero occurrences of "qsymbolic" in any source/config/test file under crates/
- 578 Rust tests pass with 0 failures
- Cargo.lock updated for new [lib] name
</success_criteria>

<output>
After completion, create `.planning/phases/09-package-rename-structure/09-01-SUMMARY.md`
</output>
