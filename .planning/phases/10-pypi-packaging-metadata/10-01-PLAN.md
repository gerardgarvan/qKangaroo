---
phase: 10-pypi-packaging-metadata
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crates/qsym-python/pyproject.toml
  - crates/qsym-python/python/q_kangaroo/__init__.py
  - LICENSE
  - CITATION.cff
autonomous: true

must_haves:
  truths:
    - "pip show q-kangaroo displays author, license, description, classifiers, project URLs, keywords"
    - "Wheel filename contains cp39-abi3 pattern instead of cp314-cp314"
    - "LICENSE file exists at project root with MIT text"
    - "CITATION.cff file exists at project root with CFF 1.2.0 format"
    - "DLLs load from bundled package directory when installed via wheel, with MinGW fallback for dev"
  artifacts:
    - path: "crates/qsym-python/pyproject.toml"
      provides: "Complete PEP 621 metadata + maturin ABI3 features + DLL include config"
      contains: "abi3-py39"
    - path: "crates/qsym-python/python/q_kangaroo/__init__.py"
      provides: "Package-relative DLL loading with MinGW fallback"
      contains: "libgmp-10.dll"
    - path: "LICENSE"
      provides: "MIT license text"
      contains: "MIT License"
    - path: "CITATION.cff"
      provides: "Academic citation metadata"
      contains: "cff-version: 1.2.0"
  key_links:
    - from: "crates/qsym-python/pyproject.toml"
      to: "LICENSE"
      via: "license = MIT reference"
      pattern: 'license\s*=\s*"MIT"'
    - from: "crates/qsym-python/pyproject.toml"
      to: "maturin build"
      via: "include DLL glob for wheel bundling"
      pattern: "include.*\\.dll"
---

<objective>
Complete pyproject.toml metadata, enable ABI3 stable ABI, create LICENSE and CITATION.cff, configure DLL bundling and package-relative DLL loading.

Purpose: These are the foundational config changes that the wheel build (Plan 02) depends on. Metadata determines what pip show displays, ABI3 determines wheel compatibility range, and DLL loading determines whether the wheel works on machines without MinGW.
Output: Updated pyproject.toml, __init__.py; new LICENSE and CITATION.cff files.
</objective>

<execution_context>
@C:/Users/Owner/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Owner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-pypi-packaging-metadata/10-RESEARCH.md
@crates/qsym-python/pyproject.toml
@crates/qsym-python/Cargo.toml
@crates/qsym-python/python/q_kangaroo/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Complete pyproject.toml metadata, ABI3 config, LICENSE, and CITATION.cff</name>
  <files>
    crates/qsym-python/pyproject.toml
    LICENSE
    CITATION.cff
  </files>
  <action>
1. Update `crates/qsym-python/pyproject.toml` with complete PEP 621 metadata:
   - `description = "Symbolic computation engine for q-series, partition functions, and modular forms"`
   - `requires-python = ">=3.9"` (already present, keep)
   - `license = "MIT"`
   - `keywords = ["q-series", "partitions", "modular-forms", "symbolic-computation", "number-theory", "theta-functions", "mock-theta", "hypergeometric", "bailey-chains", "eta-quotients"]`
   - `authors = [{ name = "Author Name", email = "author@example.com" }]` (placeholder -- user fills before publish)
   - `classifiers` list with: Development Status :: 4 - Beta, Intended Audience :: Science/Research, License :: OSI Approved :: MIT License, Operating System :: Microsoft :: Windows, Operating System :: POSIX :: Linux, Programming Language :: Python :: 3, Programming Language :: Python :: 3.9, Programming Language :: Python :: 3.10, Programming Language :: Python :: 3.11, Programming Language :: Python :: 3.12, Programming Language :: Python :: 3.13, Programming Language :: Python :: 3.14, Programming Language :: Python :: Implementation :: CPython, Programming Language :: Rust, Topic :: Scientific/Engineering :: Mathematics
   - `[project.urls]` section with Homepage, Repository, "Bug Tracker", Documentation (use placeholder github.com/OWNER/q-kangaroo URLs)
   - Update `[tool.maturin]` features to: `["pyo3/extension-module", "pyo3/abi3-py39"]` (add abi3 feature via maturin features, NOT in Cargo.toml -- per research recommendation to keep Cargo.toml clean and avoid feature conflicts)
   - Add `include = [{ path = "python/q_kangaroo/*.dll", format = "wheel" }]` for DLL bundling

2. Do NOT modify `crates/qsym-python/Cargo.toml`. The pyo3 dependency stays as `features = ["extension-module"]` only. The abi3-py39 feature is passed through `[tool.maturin] features` in pyproject.toml, which translates to cargo features at build time. Research warns about feature conflicts when abi3 is specified in both places.

3. Create `LICENSE` at project root (C:/cygwin64/home/Owner/Kangaroo/LICENSE) with standard MIT License text. Use "Author Name" as placeholder for copyright holder and 2026 as year.

4. Create `CITATION.cff` at project root with CFF 1.2.0 format:
   ```yaml
   cff-version: 1.2.0
   message: "If you use this software, please cite it using these metadata."
   title: "q-Kangaroo"
   abstract: "Open-source symbolic computation engine for q-series, partition functions, and modular forms, replacing proprietary Maple packages."
   type: software
   authors:
     - family-names: "LastName"
       given-names: "FirstName"
   license: MIT
   version: 0.1.0
   date-released: "2026-02-14"
   repository-code: "https://github.com/OWNER/q-kangaroo"
   keywords:
     - q-series
     - partitions
     - modular forms
     - symbolic computation
     - number theory
   ```
  </action>
  <verify>
Verify files exist and contain expected content:
- `python -c "import tomllib; d=tomllib.load(open('crates/qsym-python/pyproject.toml','rb')); assert 'classifiers' in d['project']; assert d['project']['license']=='MIT'; print('OK')"` (run from project root)
- Confirm LICENSE file contains "MIT License"
- Confirm CITATION.cff contains "cff-version: 1.2.0"
- Confirm pyproject.toml [tool.maturin] features includes "pyo3/abi3-py39"
  </verify>
  <done>
pyproject.toml has complete PEP 621 metadata (15 classifiers, 10 keywords, 4 URLs, license, authors) and abi3-py39 in maturin features. Cargo.toml unchanged. LICENSE has MIT text. CITATION.cff has CFF 1.2.0 format with placeholder author.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update __init__.py for package-relative DLL loading</name>
  <files>
    crates/qsym-python/python/q_kangaroo/__init__.py
  </files>
  <action>
Update the Windows DLL loading block in `__init__.py` to prefer bundled DLLs (package-relative) over the hardcoded MinGW path:

```python
if sys.platform == "win32":
    _pkg_dir = os.path.dirname(os.path.abspath(__file__))
    # Prefer bundled DLLs from installed wheel
    if os.path.isfile(os.path.join(_pkg_dir, "libgmp-10.dll")):
        os.add_dll_directory(_pkg_dir)
    else:
        # Fallback for development: MinGW in PATH or env var
        _mingw_dir = os.environ.get("MINGW_BIN", r"C:\mingw64-gcc\mingw64\bin")
        if os.path.isdir(_mingw_dir):
            os.add_dll_directory(_mingw_dir)
```

This replaces the current code that always uses the MinGW path. The logic is:
1. Check if `libgmp-10.dll` exists in the package directory (means installed from wheel with bundled DLLs)
2. If yes, register the package directory for DLL search
3. If no (development mode), fall back to MINGW_BIN env var or hardcoded MinGW path

Keep everything else in __init__.py unchanged (imports, __all__, symbols function, docstring).
  </action>
  <verify>
- Read the file and confirm the DLL loading block checks for `libgmp-10.dll` in `_pkg_dir` first
- Run existing tests to confirm the fallback path works for development: `cd crates/qsym-python && .venv/Scripts/python -m pytest tests/ -v` (with PATH set for MinGW)
  </verify>
  <done>
__init__.py loads DLLs from package directory when bundled (installed wheel), falls back to MinGW for development. Existing 9 integration tests still pass.
  </done>
</task>

</tasks>

<verification>
- pyproject.toml parseable and contains all required metadata fields + abi3-py39 in maturin features
- Cargo.toml unchanged (no abi3-py39 there)
- LICENSE exists at project root
- CITATION.cff exists at project root
- __init__.py DLL loading prioritizes bundled DLLs
- No regressions in existing 9 Python integration tests
</verification>

<success_criteria>
- pyproject.toml has: license, keywords (10+), classifiers (15), authors, project.urls (4), description, maturin include for DLLs, abi3-py39 in maturin features
- LICENSE contains MIT License text
- CITATION.cff contains cff-version 1.2.0
- __init__.py checks package directory for libgmp-10.dll before MinGW fallback
- All 9 existing Python integration tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/10-pypi-packaging-metadata/10-01-SUMMARY.md`
</output>
