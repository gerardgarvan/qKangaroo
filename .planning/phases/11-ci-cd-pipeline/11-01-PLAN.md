---
phase: 11-ci-cd-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/ci.yml
  - README.md
autonomous: true

must_haves:
  truths:
    - "Pushing a commit to main triggers Rust tests and they pass/fail visibly"
    - "Pushing a commit to main triggers Python integration tests and they pass/fail visibly"
    - "Pull requests trigger both Rust and Python tests with results visible on the PR"
    - "Test coverage percentage is generated and uploaded to Codecov"
    - "Coverage badge URL in README points to Codecov for this repository"
  artifacts:
    - path: ".github/workflows/ci.yml"
      provides: "CI workflow with rust-tests, python-tests, and coverage jobs"
      contains: "on:"
    - path: "README.md"
      provides: "Project README with Codecov coverage badge"
      contains: "codecov.io"
  key_links:
    - from: ".github/workflows/ci.yml (rust-tests job)"
      to: "cargo test --workspace"
      via: "GMP installed via apt-get on ubuntu-latest"
      pattern: "cargo test"
    - from: ".github/workflows/ci.yml (python-tests job)"
      to: "pytest crates/qsym-python/tests/"
      via: "maturin develop then pytest"
      pattern: "pytest"
    - from: ".github/workflows/ci.yml (coverage job)"
      to: "Codecov"
      via: "cargo-tarpaulin generates XML, codecov-action uploads"
      pattern: "codecov"
---

<objective>
Create the CI workflow (.github/workflows/ci.yml) that runs Rust tests, Python integration tests, and code coverage on every push to main and on every pull request. Add a README with a Codecov coverage badge.

Purpose: Automated test feedback on every code change ensures regressions are caught immediately and coverage is tracked over time.
Output: `.github/workflows/ci.yml`, `README.md` with badge
</objective>

<execution_context>
@C:/Users/Owner/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Owner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-ci-cd-pipeline/11-RESEARCH.md
@crates/qsym-python/pyproject.toml
@Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CI workflow with Rust tests, Python tests, and coverage</name>
  <files>.github/workflows/ci.yml</files>
  <action>
Create `.github/workflows/` directory and `.github/workflows/ci.yml` with three jobs:

**Trigger:** `push: branches: [main]` and `pull_request:` (all branches).
**Top-level:** `permissions: contents: read` and `env: CARGO_TERM_COLOR: always`.

**Job 1: rust-tests**
- `runs-on: ubuntu-latest`
- Steps: checkout@v4, dtolnay/rust-toolchain@stable, actions/cache@v4 (cache ~/.cargo/registry, ~/.cargo/git, target/ keyed on runner.os + Cargo.lock hash), install GMP (`sudo apt-get update && sudo apt-get install -y libgmp-dev`), `cargo test --workspace`

**Job 2: python-tests**
- `runs-on: ubuntu-latest`
- Steps: checkout@v4, actions/setup-python@v5 with python-version '3.12', dtolnay/rust-toolchain@stable, install GMP (same apt-get), install maturin+pytest (`pip install maturin pytest`), build with maturin develop (`cd crates/qsym-python && PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1 maturin develop --release`), run pytest (`cd crates/qsym-python && pytest tests/ -v`)

**Job 3: coverage**
- `runs-on: ubuntu-latest`
- Steps: checkout@v4, dtolnay/rust-toolchain@stable, install GMP, install cargo-tarpaulin (`cargo install cargo-tarpaulin`), generate coverage (`cargo tarpaulin --workspace --out xml --output-dir coverage/`), upload to Codecov using codecov/codecov-action@v5 with `files: coverage/cobertura.xml`, `fail_ci_if_error: false`, `token: ${{ secrets.CODECOV_TOKEN }}`

**Important details:**
- Do NOT use `--locked` flag on cargo test (Cargo.lock is at workspace root and may not be committed yet for CI fresh clones -- let cargo resolve)
- Actually, DO use `--locked` if Cargo.lock is committed. Check if Cargo.lock exists in repo root. If it does, use `--locked`. If not, omit it.
- The cache key should use `hashFiles('**/Cargo.lock')` for cargo caching
- Python tests need `working-directory` or explicit `cd` since pyproject.toml is in `crates/qsym-python/`
- Coverage only needs to run on the Rust crate tests (Linux only, per research -- tarpaulin is Linux-only)
  </action>
  <verify>
Validate the YAML is syntactically correct:
- Ensure proper indentation (2-space YAML)
- Verify all action versions are pinned (@v4, @v5, @stable, @v1, @release/v1)
- Confirm the three jobs exist: rust-tests, python-tests, coverage
- Confirm trigger is on push to main and pull_request
- Confirm GMP is installed in all three jobs
- Confirm PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1 is set for Python build
  </verify>
  <done>
.github/workflows/ci.yml exists with three jobs (rust-tests, python-tests, coverage) triggered on push to main and pull requests. Each job installs GMP, runs its respective task, and coverage uploads to Codecov.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create README with project description and coverage badge</name>
  <files>README.md</files>
  <action>
Create `README.md` at the project root with:

1. **Title line:** `# q-Kangaroo`
2. **Badges line** (immediately after title):
   - Codecov badge: `[![codecov](https://codecov.io/gh/OWNER/q-kangaroo/graph/badge.svg)](https://codecov.io/gh/OWNER/q-kangaroo)`
   - Use `OWNER` as a placeholder (same as in pyproject.toml URLs) -- user replaces with their GitHub username before pushing

3. **Description paragraph:** Brief description of the project as a symbolic computation engine for q-series, partitions, and modular forms. Mention it is a Rust core with Python bindings.

4. **Key features list** (bullet points): q-Pochhammer symbols, theta functions, partition functions, hypergeometric series, mock theta functions, Bailey chains, identity proving, series analysis tools.

5. **Installation section** (placeholder): `pip install q-kangaroo` (note: not yet published)

6. **Quick example** (simple Python snippet showing import and basic usage like `partition_count`)

7. **License:** MIT

Keep the README concise -- Phase 12 will expand it significantly with full documentation. This is the minimum needed for the coverage badge requirement (CI-05) and basic project identification.

Note: The `OWNER` placeholder in the Codecov badge URL matches the `OWNER` placeholder already used in pyproject.toml project URLs. The user will do a find-replace across the repo before first publish.
  </action>
  <verify>
- README.md exists at project root
- Contains Codecov badge with `codecov.io` URL
- Contains project title "q-Kangaroo"
- Contains basic project description
- Contains pip install instruction
  </verify>
  <done>
README.md exists with Codecov coverage badge, project description, feature list, and installation placeholder. Badge URL uses OWNER placeholder matching pyproject.toml convention.
  </done>
</task>

</tasks>

<verification>
Phase 11 Plan 01 verification:
1. `.github/workflows/ci.yml` exists and contains valid YAML with 3 jobs
2. ci.yml triggers on push to main and pull_request
3. rust-tests job runs `cargo test --workspace` with GMP installed
4. python-tests job runs `maturin develop` + `pytest` with GMP and ABI3 compat flag
5. coverage job runs `cargo tarpaulin` and uploads to Codecov
6. README.md exists with Codecov badge URL
</verification>

<success_criteria>
- CI workflow file created at `.github/workflows/ci.yml`
- Three jobs defined: rust-tests, python-tests, coverage
- All jobs install GMP as a prerequisite
- Python job uses PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1
- Coverage job uses cargo-tarpaulin + codecov-action
- README.md has Codecov badge (CI-05 satisfied)
- Requirements CI-01, CI-02, CI-05 are covered
</success_criteria>

<output>
After completion, create `.planning/phases/11-ci-cd-pipeline/11-01-SUMMARY.md`
</output>
