---
phase: 12-documentation-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crates/qsym-python/src/series.rs
  - crates/qsym-python/python/q_kangaroo/__init__.py
  - crates/qsym-python/python/q_kangaroo/_q_kangaroo.pyi
  - crates/qsym-python/python/q_kangaroo/__init__.pyi
  - README.md
autonomous: true

must_haves:
  truths:
    - "QSeries displays rendered LaTeX in Jupyter notebooks via _repr_latex_()"
    - "QSeries has readable __repr__ in terminal sessions (already exists, verify preserved)"
    - "README contains pip install command, a working quickstart example, and a verification command"
    - "A get_default_session() convenience function exists for interactive use"
  artifacts:
    - path: "crates/qsym-python/src/series.rs"
      provides: "QSeries _repr_latex_() method"
      contains: "_repr_latex_"
    - path: "crates/qsym-python/python/q_kangaroo/__init__.py"
      provides: "get_default_session() convenience function"
      contains: "get_default_session"
    - path: "README.md"
      provides: "Installation instructions, quickstart, verification command"
      contains: "pip install q-kangaroo"
    - path: "crates/qsym-python/python/q_kangaroo/_q_kangaroo.pyi"
      provides: "Updated type stub with _repr_latex_ on QSeries"
      contains: "_repr_latex_"
  key_links:
    - from: "crates/qsym-python/src/series.rs"
      to: "QSeries.fps.coefficients"
      via: "_repr_latex_ iterates BTreeMap entries"
      pattern: "_repr_latex_.*String"
    - from: "crates/qsym-python/python/q_kangaroo/__init__.py"
      to: "_q_kangaroo.QSession"
      via: "get_default_session creates QSession lazily"
      pattern: "get_default_session"
---

<objective>
Add QSeries LaTeX rendering for Jupyter notebooks, a get_default_session() convenience helper, and expand the README with proper installation/quickstart/verification instructions.

Purpose: Satisfies UX-01 (Jupyter LaTeX rendering for QSeries), UX-04 (sensible defaults via get_default_session), DOC-01 (README with install/quickstart/verify). QExpr already has _repr_latex_() and __repr__; QSeries needs the same LaTeX treatment.

Output: Updated series.rs with _repr_latex_(), updated __init__.py with get_default_session(), updated type stubs, expanded README.
</objective>

<execution_context>
@C:/Users/Owner/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Owner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-documentation-ux-polish/12-RESEARCH.md
@crates/qsym-python/src/series.rs
@crates/qsym-python/src/expr.rs
@crates/qsym-python/python/q_kangaroo/__init__.py
@crates/qsym-python/python/q_kangaroo/_q_kangaroo.pyi
@crates/qsym-core/src/series/display.rs
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add QSeries _repr_latex_() and update type stubs</name>
  <files>
    crates/qsym-python/src/series.rs
    crates/qsym-python/python/q_kangaroo/_q_kangaroo.pyi
  </files>
  <action>
Add a `_repr_latex_(&self) -> String` method to the `#[pymethods] impl QSeries` block in series.rs. Model it closely on the existing `Display for FormalPowerSeries` in `crates/qsym-core/src/series/display.rs`, but emit LaTeX instead of plain text:

1. Iterate `self.fps.coefficients` (BTreeMap<i64, QRat>) in order.
2. For each term with coefficient `c` at power `k`:
   - Determine sign. For first term, emit `-` prefix if negative. For subsequent, emit ` + ` or ` - `.
   - Format absolute coefficient: if `|c| == 1` and `k != 0`, omit coefficient. If denominator is 1, emit integer. Otherwise emit `\frac{num}{den}`.
   - Format variable part: `k==0` nothing, `k==1` emit `q`, `k>1` emit `q^{k}`. Also handle negative k with `q^{-k}` syntax.
   - Combine coefficient and variable with a space (not `*`) for LaTeX: `\frac{3}{5} q^{7}`.
3. Truncation display: for readability, if there are more than 20 non-zero terms, show first 15 terms + ` + \cdots` + last 2 terms.
4. Append `+ O(q^{N})` where N is `self.fps.truncation_order()`. Use braces for multi-digit: `O(q^{10})`.
5. Zero series: just `O(q^{N})`.
6. Wrap entire string in `$...$` for Jupyter rendering.

Also add a `latex(&self) -> String` method (without `$` wrappers) for consistency with QExpr.

In `_q_kangaroo.pyi`, add to the QSeries class:
```python
def _repr_latex_(self) -> str:
    """LaTeX representation for Jupyter notebooks."""
    ...
def latex(self) -> str:
    """LaTeX string without dollar-sign wrappers."""
    ...
```

Use `std::cmp::Ordering` for sign comparison (same pattern as display.rs).
Do NOT modify the existing __repr__ or __str__ methods.
  </action>
  <verify>
Build and run tests:
```bash
export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH"
cd crates/qsym-python && PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1 cargo test --locked
```
Then verify the method exists via Python:
```bash
cd crates/qsym-python && PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1 maturin develop --release && python -c "
from q_kangaroo import QSession, etaq
s = QSession()
e = etaq(s, 1, 1, 10)
latex = e._repr_latex_()
print(repr(latex))
assert latex.startswith('$'), f'Should start with dollar: {latex}'
assert latex.endswith('$'), f'Should end with dollar: {latex}'
assert 'O(q^{10})' in latex, f'Should contain truncation: {latex}'
print('QSeries _repr_latex_ OK')
"
```
  </verify>
  <done>QSeries._repr_latex_() returns a $...$-wrapped LaTeX string with proper term formatting, fraction rendering, and truncation display. Type stub updated with the new method signature.</done>
</task>

<task type="auto">
  <name>Task 2: Add get_default_session() and expand README</name>
  <files>
    crates/qsym-python/python/q_kangaroo/__init__.py
    crates/qsym-python/python/q_kangaroo/__init__.pyi
    README.md
  </files>
  <action>
**__init__.py changes:**

1. Add a `get_default_session()` function that lazily creates a module-level default QSession:
```python
_default_session = None

def get_default_session():
    """Return a shared default QSession for interactive use.

    Creates a new session on first call, reuses it for subsequent calls.
    For production use, create explicit QSession instances instead.
    """
    global _default_session
    if _default_session is None:
        _default_session = QSession()
    return _default_session
```

2. Add `"get_default_session"` to `__all__`.

3. Update `__init__.pyi` to include:
```python
def get_default_session() -> QSession:
    """Return a shared default QSession for interactive use."""
    ...
```

**README.md rewrite:**

Replace the current README with a comprehensive version:

1. **Title + badges:** q-Kangaroo with codecov badge (keep existing) + add "License: MIT" badge.

2. **One-paragraph description** matching the current one but polished.

3. **Installation section:**
   - `pip install q-kangaroo`
   - Note about pre-release status
   - "From source" subsection with clone + maturin develop instructions
   - Requirements: Python 3.9+, GMP library (auto-bundled on wheels)

4. **Quick Start section** with a WORKING example that uses the actual API correctly:
```python
from q_kangaroo import QSession, etaq, partition_count, theta3

# Count integer partitions
for n in range(6):
    print(f"p({n}) = {partition_count(n)}")
# p(0) = 1, p(1) = 1, p(2) = 2, p(3) = 3, p(4) = 5, p(5) = 7

# Compute Euler's function (q;q)_inf as a power series
s = QSession()
euler = etaq(s, 1, 1, 20)
print(euler)  # 1 - q - q^2 + q^5 + q^7 - q^12 - q^15 + O(q^20)

# Jacobi theta function
t3 = theta3(s, 20)
print(t3)  # 1 + 2*q + 2*q^4 + 2*q^9 + 2*q^16 + O(q^20)
```

5. **Verification command:**
```python
python -c "from q_kangaroo import partition_count; assert partition_count(100) == 190569292536040; print('q-Kangaroo is working!')"
```

6. **Features section** (keep existing but format as a bulleted list with brief descriptions).

7. **Jupyter section** showing that `_repr_latex_()` works (brief note: "QExpr and QSeries render as LaTeX in Jupyter automatically").

8. **License** section.

IMPORTANT: Fix the current README's Quick Example which uses incorrect API (`session.var("q")`, `session.qpochhammer_inf(q)` -- these methods don't exist). The correct API uses DSL functions like `etaq(session, b, t, order)`.
  </action>
  <verify>
```bash
python -c "
from q_kangaroo import get_default_session, QSession
s1 = get_default_session()
s2 = get_default_session()
assert s1 is s2, 'Should return same session'
assert isinstance(s1, QSession), 'Should be QSession'
print('get_default_session OK')
"
```
Verify README has no broken examples by running the Quick Start code:
```bash
python -c "
from q_kangaroo import QSession, etaq, partition_count, theta3
for n in range(6):
    p = partition_count(n)
    print(f'p({n}) = {p}')
s = QSession()
euler = etaq(s, 1, 1, 20)
print(euler)
t3 = theta3(s, 20)
print(t3)
print('README examples OK')
"
```
  </verify>
  <done>get_default_session() lazily creates and reuses a module-level QSession. README has working pip install instructions, a correct quickstart example using the actual DSL API, and a verification one-liner. The old incorrect example (session.var, session.qpochhammer_inf) is replaced.</done>
</task>

</tasks>

<verification>
- `cargo test --workspace --locked` passes (no Rust regressions)
- `pytest tests/ -v` passes (no Python regressions)
- QSeries._repr_latex_() returns valid $...$ LaTeX string
- get_default_session() returns a singleton QSession
- README quickstart code runs without errors
- Type stubs include new methods
</verification>

<success_criteria>
- UX-01 partially satisfied: QSeries now has _repr_latex_() (QExpr already had it)
- UX-02 preserved: __repr__ unchanged
- UX-04 partially satisfied: get_default_session() provides easy interactive use
- DOC-01 satisfied: README has install, quickstart, and verification
</success_criteria>

<output>
After completion, create `.planning/phases/12-documentation-ux-polish/12-01-SUMMARY.md`
</output>
