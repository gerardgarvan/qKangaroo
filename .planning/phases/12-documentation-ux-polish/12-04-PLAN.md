---
phase: 12-documentation-ux-polish
plan: 04
type: execute
wave: 3
depends_on: ["12-03"]
files_modified:
  - docs/examples/partition_congruences.ipynb
  - docs/examples/theta_identities.ipynb
  - docs/examples/hypergeometric_summation.ipynb
  - docs/examples/mock_theta_functions.ipynb
  - docs/examples/bailey_chains.ipynb
  - docs/examples/index.rst
  - docs/index.rst
  - .github/workflows/docs.yml
autonomous: true

must_haves:
  truths:
    - "Five narrative example notebooks exist covering partition congruences, theta identities, hypergeometric summation, mock theta functions, and Bailey chains"
    - "Docs CI workflow builds Sphinx site and deploys to GitHub Pages on push to main"
    - "Example notebooks are pre-executed with output cells visible in rendered docs"
    - "sphinx-build completes successfully including notebook rendering"
  artifacts:
    - path: "docs/examples/partition_congruences.ipynb"
      provides: "Ramanujan congruence discovery example"
    - path: "docs/examples/theta_identities.ipynb"
      provides: "Jacobi theta function identity verification example"
    - path: "docs/examples/hypergeometric_summation.ipynb"
      provides: "q-Gauss and q-Vandermonde summation example"
    - path: "docs/examples/mock_theta_functions.ipynb"
      provides: "Classical mock theta overview example"
    - path: "docs/examples/bailey_chains.ipynb"
      provides: "Bailey pair discovery and chain example"
    - path: ".github/workflows/docs.yml"
      provides: "GitHub Actions workflow for docs build + deploy"
      contains: "sphinx-build"
  key_links:
    - from: "docs/index.rst"
      to: "docs/examples/index.rst"
      via: "toctree includes examples"
      pattern: "examples/index"
    - from: ".github/workflows/docs.yml"
      to: "docs/"
      via: "sphinx-build command"
      pattern: "sphinx-build.*docs"
    - from: ".github/workflows/docs.yml"
      to: "gh-pages branch"
      via: "peaceiris/actions-gh-pages deploys HTML"
      pattern: "peaceiris/actions-gh-pages"
---

<objective>
Create 5 narrative example notebooks and a CI workflow to build and deploy the Sphinx documentation site to GitHub Pages.

Purpose: Satisfies DOC-02 (deployed on GitHub Pages), DOC-05 (5+ narrative examples). The example gallery covers the major feature areas: partition congruences, theta identities, hypergeometric summation, mock theta functions, and Bailey chains. Each notebook tells a mathematical story with code, output, and explanation.

Output: 5 pre-executed Jupyter notebooks in docs/examples/, docs.yml CI workflow, updated docs/index.rst with examples toctree.
</objective>

<execution_context>
@C:/Users/Owner/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Owner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-documentation-ux-polish/12-RESEARCH.md
@.planning/phases/12-documentation-ux-polish/12-03-SUMMARY.md
@.github/workflows/ci.yml
@docs/conf.py
@docs/index.rst
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create 5 example notebooks with pre-executed output</name>
  <files>
    docs/examples/partition_congruences.ipynb
    docs/examples/theta_identities.ipynb
    docs/examples/hypergeometric_summation.ipynb
    docs/examples/mock_theta_functions.ipynb
    docs/examples/bailey_chains.ipynb
    docs/examples/index.rst
    docs/index.rst
  </files>
  <action>
Create `docs/examples/` directory and 5 Jupyter notebooks. Each notebook should be a valid .ipynb JSON file with pre-executed output cells (since nbsphinx_execute="never"). Also create an index.rst for the gallery and update the main docs/index.rst to include the examples toctree.

**Notebook format:** Each .ipynb is JSON with nbformat 4.5, cells containing markdown (narrative) and code (with outputs). Since we cannot execute notebooks interactively, CREATE the notebooks as .ipynb JSON files with code cells that have pre-populated output matching what the code would produce. Use `execute_count` values starting from 1.

For output cells, include `text/plain` output_type `execute_result` or `stream` as appropriate. For series output, use the `__repr__` format (e.g., `1 - q - q^2 + q^5 + q^7 + O(q^20)`).

**To generate accurate output:** Before writing the notebooks, run the Python code for each example and capture the actual output. Use the Cygwin Python environment:
```bash
export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH"
cd crates/qsym-python && PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1 maturin develop --release
```
Then run each code snippet via `python -c "..."` to get exact output strings for the notebook cells.

**Notebook 1: partition_congruences.ipynb** -- "Discovering Ramanujan's Partition Congruences"
- Intro markdown: partition function p(n), Ramanujan's congruences p(5n+4)=0 mod 5, etc.
- Cell 1: Import and count partitions for n=0..15
- Cell 2: Compute partition_gf to order 50
- Cell 3: Use sift to extract p(5n+4) subsequence
- Cell 4: Use findcong to discover congruences with moduli [2,3,5,7,11]
- Cell 5: Verify p(5n+4) mod 5 = 0 for first several values
- Closing markdown: historical context, connection to Dyson's rank

**Notebook 2: theta_identities.ipynb** -- "Jacobi Theta Function Identities"
- Intro: Jacobi theta functions, product representations
- Cell 1: Compute theta3, theta4 to order 30
- Cell 2: Verify theta3(q)^2 + theta4(q)^2 (Jacobi identity structure)
- Cell 3: Show etaq products matching theta function formulas
- Cell 4: Demonstrate theta3 coefficients are {0,2} for n>0 (squares only)
- Closing: connection to modular forms

**Notebook 3: hypergeometric_summation.ipynb** -- "Basic Hypergeometric Summation"
- Intro: basic hypergeometric series, notation
- Cell 1: Evaluate a simple 2phi1 via phi()
- Cell 2: Apply try_summation to find closed form (q-Gauss)
- Cell 3: Compare direct evaluation vs closed form
- Cell 4: Heine's first transformation
- Closing: references to DLMF Chapter 17

**Notebook 4: mock_theta_functions.ipynb** -- "Classical Mock Theta Functions"
- Intro: Ramanujan's last letter, mock theta functions
- Cell 1: Compute third-order f(q), phi(q), psi(q)
- Cell 2: Show coefficients of f(q) are always non-negative
- Cell 3: Compute fifth-order functions
- Cell 4: Demonstrate Appell-Lerch sum g2
- Closing: connection to Zwegers' thesis, harmonic Maass forms

**Notebook 5: bailey_chains.ipynb** -- "Bailey Pairs and Chain Discovery"
- Intro: Bailey pairs, Bailey lemma, chain iteration
- Cell 1: Apply weak Bailey lemma to Rogers-Ramanujan pair
- Cell 2: Apply Bailey lemma with specific parameters
- Cell 3: Build a Bailey chain of depth 2
- Cell 4: Use bailey_discover to identify a pair
- Closing: significance for partition identities

**docs/examples/index.rst:**
```rst
Example Gallery
===============

These notebooks demonstrate key features of q-Kangaroo with mathematical context.

.. toctree::
   :maxdepth: 1

   partition_congruences
   theta_identities
   hypergeometric_summation
   mock_theta_functions
   bailey_chains
```

**Update docs/index.rst** to add the examples toctree:
```rst
.. toctree::
   :maxdepth: 2
   :caption: Examples

   examples/index
```
Insert this after the API Reference toctree.

IMPORTANT: The .ipynb files must be valid JSON. Use nbformat version 4, minor version 5. Each cell needs proper metadata. Markdown cells use `"cell_type": "markdown"`. Code cells use `"cell_type": "code"` with `"outputs"` array containing the pre-captured output.
  </action>
  <verify>
Verify notebooks are valid JSON:
```bash
python -c "
import json
notebooks = [
    'docs/examples/partition_congruences.ipynb',
    'docs/examples/theta_identities.ipynb',
    'docs/examples/hypergeometric_summation.ipynb',
    'docs/examples/mock_theta_functions.ipynb',
    'docs/examples/bailey_chains.ipynb',
]
for nb in notebooks:
    with open(nb) as f:
        data = json.load(f)
    assert data['nbformat'] == 4, f'{nb}: wrong nbformat'
    assert len(data['cells']) >= 4, f'{nb}: too few cells'
    code_cells = [c for c in data['cells'] if c['cell_type'] == 'code']
    cells_with_output = [c for c in code_cells if c.get('outputs')]
    print(f'{nb}: {len(data[\"cells\"])} cells, {len(code_cells)} code, {len(cells_with_output)} with output')
print('All notebooks valid')
"
```
Rebuild docs with notebooks:
```bash
cd C:/cygwin64/home/Owner/Kangaroo && sphinx-build -b html docs docs/_build/html 2>&1 | tail -10
ls docs/_build/html/examples/partition_congruences.html
```
  </verify>
  <done>5 narrative example notebooks exist in docs/examples/ with pre-executed output cells. docs/index.rst includes examples toctree. Sphinx build includes notebook rendering via nbsphinx.</done>
</task>

<task type="auto">
  <name>Task 2: Create docs CI workflow for GitHub Pages deployment</name>
  <files>.github/workflows/docs.yml</files>
  <action>
Create `.github/workflows/docs.yml` that builds the Sphinx docs and deploys to GitHub Pages.

```yaml
name: Documentation

on:
  push:
    branches: [main]
  pull_request:

permissions:
  contents: write

jobs:
  docs:
    name: Build & Deploy Docs
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - uses: dtolnay/rust-toolchain@stable

      - uses: actions/cache@v4
        with:
          path: |
            ~/.cargo/registry
            ~/.cargo/git
            target
          key: ${{ runner.os }}-docs-cargo-${{ hashFiles('**/Cargo.lock') }}
          restore-keys: |
            ${{ runner.os }}-docs-cargo-

      - name: Install GMP
        run: sudo apt-get update && sudo apt-get install -y libgmp-dev

      - name: Build Python extension
        working-directory: crates/qsym-python
        run: |
          pip install maturin
          PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1 maturin develop --release

      - name: Install docs dependencies
        run: pip install -r docs/requirements.txt

      - name: Build documentation
        run: sphinx-build -b html docs docs/_build/html

      - name: Deploy to GitHub Pages
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: docs/_build/html
```

Key design decisions:
- Build the native module in CI so autodoc can import it and extract docstrings.
- Use `peaceiris/actions-gh-pages@v4` which automatically adds `.nojekyll`.
- Cache cargo artifacts for faster rebuilds.
- Only deploy on push to main (not on PRs -- PRs just verify the build succeeds).
- Use `contents: write` permission for gh-pages deployment.
- Do NOT use `-W` flag on sphinx-build in CI to avoid failing on minor warnings. The local build in Plan 03 already verified with `-W`.
  </action>
  <verify>
Validate YAML syntax:
```bash
python -c "
import yaml
with open('.github/workflows/docs.yml') as f:
    data = yaml.safe_load(f)
assert 'jobs' in data, 'Missing jobs'
assert 'docs' in data['jobs'], 'Missing docs job'
steps = data['jobs']['docs']['steps']
step_names = [s.get('name', s.get('uses', '')) for s in steps]
print('Steps:', step_names)
assert any('sphinx' in str(s).lower() for s in steps), 'Missing sphinx-build step'
assert any('peaceiris' in str(s.get('uses', '')) for s in steps), 'Missing deploy step'
print('docs.yml structure OK')
"
```
Verify it doesn't conflict with existing workflows:
```bash
ls .github/workflows/
```
  </verify>
  <done>docs.yml workflow builds the native Python extension, installs Sphinx deps, runs sphinx-build, and deploys to GitHub Pages via peaceiris/actions-gh-pages on pushes to main. PR builds verify docs build without deploying.</done>
</task>

</tasks>

<verification>
- All 5 notebooks are valid .ipynb JSON with pre-executed output
- `sphinx-build -b html docs docs/_build/html` includes notebook rendering
- docs/_build/html/examples/partition_congruences.html exists
- .github/workflows/docs.yml has valid YAML structure
- docs.yml builds module, installs deps, runs sphinx-build, deploys on main
</verification>

<success_criteria>
- DOC-02 fully satisfied: Sphinx site with CI deployment to GitHub Pages
- DOC-05 satisfied: 5 narrative examples (partition congruences, theta identities, hypergeometric summation, mock theta functions, Bailey chains)
- Phase 12 complete: all DOC-01 through DOC-07 and UX-01 through UX-05 addressed
</success_criteria>

<output>
After completion, create `.planning/phases/12-documentation-ux-polish/12-04-SUMMARY.md`
</output>
