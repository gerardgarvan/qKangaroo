---
phase: 18-docstring-enrichment
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - crates/qsym-python/src/dsl.rs
autonomous: true

must_haves:
  truths:
    - "Groups 5-7 (21 functions) have research-quality examples showing real mathematical workflows"
    - "Relation discovery functions demonstrate actual research use cases (Ramanujan congruences, eta-quotient relations)"
    - "All functions in Groups 5-7 have complete See Also cross-references"
  artifacts:
    - path: "crates/qsym-python/src/dsl.rs"
      provides: "Enriched docstrings for Groups 5-7 (lines 799-1704)"
      contains: "Notes\n/// -----"
  key_links:
    - from: "sift docstring"
      to: "findcong, partition_gf"
      via: "See Also and example showing workflow"
      pattern: "sift.*partition"
    - from: "findcong docstring"
      to: "sift, partition_gf, etaq"
      via: "See Also cross-references"
      pattern: "See Also"
---

<objective>
Enrich docstrings for Groups 5-7 of dsl.rs (21 functions: factoring/utilities/prodmake, relation discovery exact, relation discovery modular).

Purpose: These functions form the analysis workflow core -- the enriched examples should demonstrate real research pipelines like "compute partition GF -> sift -> discover congruence" and "build eta-quotient basis -> find relations".

Output: Updated dsl.rs with enriched docstrings for lines 799-1704.
</objective>

<execution_context>
@C:/Users/Owner/.claude/agents/gsd-executor.md
@C:/Users/Owner/.claude/agents/gsd-summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-docstring-enrichment/18-01-SUMMARY.md
@crates/qsym-python/src/dsl.rs (lines 799-1704)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enrich Group 5 docstrings (9 functions: qfactor, sift, qdegree, lqdegree, prodmake, etamake, jacprodmake, mprodmake, qetamake)</name>
  <files>crates/qsym-python/src/dsl.rs</files>
  <action>
Read lines 799-1153 of dsl.rs. For each of the 9 functions, enrich the docstring:

**GROUP 5: Factoring, Utilities, and Prodmake (9 functions)**

1. `qfactor` (lines 803-845):
   - Examples: Show factoring etaq(s,1,1,20) to get {1: -1} (since (q;q)_inf = prod(1-q^k)). Show factoring a q-binomial product.
   - Notes: "Uses top-down polynomial division to express a q-polynomial as $c \cdot \prod_i (1-q^i)^{m_i}$. Exact factorization succeeds for products of cyclotomic-type factors."
   - See Also: Keep `prodmake`. Add `etaq`, `mprodmake`.

2. `sift` (lines 847-883):
   - Examples: Show the Ramanujan congruence workflow: `pgf = partition_gf(s, 200)`, `s5_4 = sift(pgf, 5, 4)` then explain that all coefficients of s5_4 are divisible by 5. Show sift(pgf, 7, 5) for the mod-7 congruence.
   - Notes: "The sift operation extracts the arithmetic subsequence $f[mi+j]$, producing a new series $g$ with $g[n] = f[mn+j]$. This is the key tool for studying partition congruences and other arithmetic properties of q-series coefficients."
   - See Also: Keep `findcong`. Add `partition_gf`, `findlincombo`, `etaq`.

3. `qdegree` (lines 885-~920):
   - Examples: Show qdegree of a finite polynomial like qbin(s, 4, 2, 20) returning the degree.
   - See Also: Add `lqdegree`, `qfactor`.

4. `lqdegree` (lines ~920-~950):
   - Examples: Show lowest degree of partition_gf (which is 0) vs etaq (which is also 0) vs a shifted series.
   - See Also: Add `qdegree`, `sift`.

5. `prodmake` (lines ~950-~1010):
   - Examples: Show prodmake on partition_gf recovering {1: -1} (the eta-quotient representation). Show prodmake on a theta function. Show the Andrews algorithm producing infinite product exponents.
   - Notes: "Implements Andrews' algorithm: compute the log derivative $-f'/f$, find recurrence coefficients $c_n$ via $q \cdot d/dq$, then use Mobius inversion to recover $(1-q^n)$ exponents. The result is $f = \prod_{n \ge 1} (1-q^n)^{a_n}$."
   - See Also: Add `etamake`, `jacprodmake`, `mprodmake`, `qfactor`, `partition_gf`.

6. `etamake` (lines ~1010-~1060):
   - Examples: Show etamake on partition_gf recovering the eta-quotient form. Compare with prodmake output.
   - Notes: "Groups the prodmake exponents by divisor $d$, producing the eta-quotient form $\prod_d (q^d; q^d)_\infty^{e_d}$. Only succeeds when exponents have finite eta-quotient support."
   - See Also: Add `prodmake`, `etaq`, `jacprodmake`.

7. `jacprodmake` (lines ~1060-~1110):
   - Examples: Show jacprodmake recovering Jacobi product representation of a theta function or related series.
   - Notes: "Searches for a period $m$ such that the prodmake exponents group into residue classes modulo $m$, producing a representation in terms of $(q^a; q^m)_\infty$ factors."
   - See Also: Add `prodmake`, `etamake`, `jacprod`.

8. `mprodmake` (lines ~1110-~1140):
   - Examples: Show mprodmake on distinct_parts_gf recovering $(1+q^n)$ exponents.
   - Notes: "Extracts $(1+q^n)$ factors by using the identity $(1+q^n) = (1-q^{2n})/(1-q^n)$. Iteratively peels off factors from the prodmake representation."
   - See Also: Add `prodmake`, `distinct_parts_gf`, `etamake`.

9. `qetamake` (lines ~1140-1153):
   - Examples: Show qetamake with actual output.
   - See Also: Add `etamake`, `prodmake`.

IMPORTANT: Do NOT change any Rust code outside of `///` doc-comment lines. Preserve all function signatures and implementations.
  </action>
  <verify>
Run: `export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH" && PYO3_NO_PYTHON=1 cargo check -p qsym-python --features pyo3/abi3-py39`
Must compile without errors.
  </verify>
  <done>All 9 functions in Group 5 have enriched docstrings with realistic mathematical examples demonstrating analysis workflows, complete See Also cross-references, and Notes sections explaining the algorithms. File compiles.</done>
</task>

<task type="auto">
  <name>Task 2: Enrich Groups 6-7 docstrings (12 functions: findlincombo, findhom, findpoly, findcong, findnonhom, findhomcombo, findnonhomcombo, findlincombomodp, findhommodp, findhomcombomodp, findmaxind, findprod)</name>
  <files>crates/qsym-python/src/dsl.rs</files>
  <action>
Read lines 1154-1704 of dsl.rs. For each of the 12 functions, enrich the docstring:

**GROUP 6: Relation Discovery - exact (7 functions)**

1. `findlincombo` (lines 1158-1204):
   - Examples: REPLACE the trivial `findlincombo(f, [f], 0)` example. Show: build eta-quotient basis [etaq(s,1,1,N), etaq(s,2,2,N), ...], then express partition_gf as a linear combo. Or show expressing theta3^2 as a combination of eta products.
   - Notes: "Uses exact RREF (row reduction) over $\mathbb{Q}$ to find coefficients. The `topshift` parameter allows ignoring leading coefficients that may be anomalous."
   - See Also: Keep existing. Add `findlincombomodp`, `sift`.

2. `findhom` (lines 1206-1247):
   - Examples: Show finding a degree-2 relation among eta-quotients. E.g., relations among [etaq(s,1,5,N), etaq(s,4,5,N)] or theta functions.
   - Notes: "Generates all monomials of degree $d$ in the given series, builds a coefficient matrix, and finds the null space via RREF. Returns all independent relations."
   - See Also: Keep existing. Add `findhomcombo`, `findhommodp`.

3. `findpoly` (lines 1249-~1310):
   - Examples: Show finding a modular polynomial between j-invariant type series, or between two theta quotients.
   - Notes: "Searches for a bivariate polynomial $P(x,y) = \sum_{i,j} c_{ij} x^i y^j = 0$ by setting up a linear system from the series coefficients."
   - See Also: Keep existing. Add `findhom`, `findlincombo`.

4. `findcong` (lines ~1310-~1380):
   - Examples: Show the classic use case: `findcong(partition_gf(s, 500), 5, 100)` discovering Ramanujan's congruence p(5n+4) = 0 mod 5. Show findcong with modulus 7 for p(7n+5).
   - Notes: "Automatically sifts the series at each residue class modulo $m$, then checks which residue classes have all coefficients divisible by $m$. This is the automated tool for discovering Ramanujan-type congruences."
   - See Also: Add `sift`, `partition_gf`, `findlincombo`, `partition_count`.

5. `findnonhom` (lines ~1380-~1420):
   - Examples: Show finding a mixed-degree relation.
   - See Also: Add `findhom`, `findnonhomcombo`.

6. `findhomcombo` (lines ~1420-~1460):
   - Examples: Show expressing a target as a homogeneous combination of basis series.
   - See Also: Add `findlincombo`, `findhom`, `findnonhomcombo`.

7. `findnonhomcombo` (lines ~1460-1495):
   - Examples: Show expressing a target as a non-homogeneous combination.
   - See Also: Add `findhomcombo`, `findlincombo`.

**GROUP 7: Relation Discovery - modular (5 functions)**

8. `findlincombomodp` (lines 1496-~1560):
   - Examples: Show finding a linear combination mod a prime. Useful when exact coefficients overflow but modular arithmetic suffices.
   - Notes: "Uses modular arithmetic over $\mathbb{Z}/p\mathbb{Z}$ (Fermat inverse: $a^{-1} = a^{p-2}$). Faster than exact arithmetic and avoids coefficient explosion."
   - See Also: Add `findlincombo`, `findhommodp`.

9. `findhommodp` (lines ~1560-~1610):
   - Examples: Show finding modular homogeneous relations.
   - See Also: Add `findhom`, `findlincombomodp`, `findhomcombomodp`.

10. `findhomcombomodp` (lines ~1610-~1650):
    - Examples: Show modular homogeneous combination.
    - See Also: Add `findhomcombo`, `findhommodp`.

11. `findmaxind` (lines ~1650-~1680):
    - Examples: Show finding maximally independent subset of a collection of eta-quotients.
    - Notes: "Uses inline Gaussian elimination to find pivot columns, identifying a maximal linearly independent subset. The remaining series are redundant (expressible as linear combinations of the independent ones)."
    - See Also: Add `findlincombo`, `findhom`.

12. `findprod` (lines ~1680-1704):
    - Examples: Show finding an infinite product representation via brute-force search.
    - Notes: "Brute-force search over integer exponent vectors $[-M, M]^k$. Tests each candidate exponent vector by computing the product via prodmake and comparing. Exponential in the number of candidates -- use small candidate lists."
    - See Also: Add `prodmake`, `etamake`, `findlincombo`.

IMPORTANT: Do NOT change any Rust code outside of `///` doc-comment lines.
  </action>
  <verify>
Run: `export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH" && PYO3_NO_PYTHON=1 cargo check -p qsym-python --features pyo3/abi3-py39`
Must compile without errors.
  </verify>
  <done>All 12 functions in Groups 6-7 have enriched docstrings with research-quality examples (especially findcong showing Ramanujan congruence discovery), complete cross-references, and Notes sections explaining algorithms. File compiles.</done>
</task>

</tasks>

<verification>
- sift example demonstrates partition congruence workflow with actual mathematical meaning
- findcong example shows discovering p(5n+4) = 0 mod 5 (Ramanujan's congruence)
- prodmake example shows recovering eta-quotient from partition_gf
- All 21 functions have enriched See Also cross-references
- File compiles with PYO3_NO_PYTHON=1 cargo check
</verification>

<success_criteria>
Groups 5-7 of dsl.rs have research-quality docstrings demonstrating real analysis workflows: sift for extracting arithmetic subsequences, findcong for Ramanujan congruences, prodmake/etamake for infinite product analysis. All cross-references complete.
</success_criteria>

<output>
After completion, create `.planning/phases/18-docstring-enrichment/18-02-SUMMARY.md`
</output>
