---
phase: 18-docstring-enrichment
plan: 03
type: execute
wave: 3
depends_on: ["18-02"]
files_modified:
  - crates/qsym-python/src/dsl.rs
autonomous: true

must_haves:
  truths:
    - "Groups 8-9 (8 functions) have enriched examples with hypergeometric summation formulas and identity proving"
    - "Group 10 (27 functions) all have enriched docstrings with mathematical context for mock theta, Appell-Lerch, and Bailey"
    - "Mock theta functions have Notes sections citing Ramanujan and their order"
  artifacts:
    - path: "crates/qsym-python/src/dsl.rs"
      provides: "Enriched docstrings for Groups 8-10 (lines 1705-3216)"
      contains: "Ramanujan"
  key_links:
    - from: "phi/psi docstrings"
      to: "try_summation, heine1/2/3"
      via: "See Also showing hypergeometric workflow"
      pattern: "See Also"
    - from: "mock_theta_f3 docstring"
      to: "appell_lerch_m, bailey_discover"
      via: "See Also cross-references"
      pattern: "See Also"
---

<objective>
Enrich docstrings for Groups 8-10 of dsl.rs (35 functions: hypergeometric series, identity proving, mock theta functions, Appell-Lerch sums, Bailey machinery).

Purpose: These are the most mathematically rich functions in the library. The enriched docstrings should serve as a mini-reference for researchers, with Notes sections providing the mathematical definitions and key identities.

Output: Updated dsl.rs with enriched docstrings for lines 1705-3216.
</objective>

<execution_context>
@C:/Users/Owner/.claude/agents/gsd-executor.md
@C:/Users/Owner/.claude/agents/gsd-summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-docstring-enrichment/18-02-SUMMARY.md
@crates/qsym-python/src/dsl.rs (lines 1705-3216)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enrich Groups 8-9 docstrings (8 functions: phi, psi, try_summation, heine1, heine2, heine3, prove_eta_id, search_identities)</name>
  <files>crates/qsym-python/src/dsl.rs</files>
  <action>
Read lines 1705-2295 of dsl.rs. For each of the 8 functions, enrich the docstring:

**GROUP 8: Hypergeometric Series (6 functions)**

1. `phi` (lines 1716-1775):
   - Examples: Show q-Gauss sum: `phi(s, [(1,1,1), (1,1,2)], [(1,1,4)], 1, 1, 2, 20)` (a 2phi1 with z=q^2). Show a terminating 2phi1 that simplifies. Show the Euler identity as 1phi0.
   - Notes: "The basic hypergeometric series ${}_r\phi_s(a_1,\ldots,a_r; b_1,\ldots,b_s; q, z) = \sum_{n=0}^{\infty} \frac{(a_1;q)_n \cdots (a_r;q)_n}{(b_1;q)_n \cdots (b_s;q)_n (q;q)_n} \left[(-1)^n q^{n(n-1)/2}\right]^{1+s-r} z^n$. Parameters are specified as q-monomials $(c \cdot q^p)$ via ``(num, den, power)`` tuples. DLMF 17.4.1."
   - See Also: Keep existing. Add `q_gosper`, `q_zeilberger`, `try_summation`.

2. `psi` (lines 1777-~1840):
   - Examples: Show Jacobi triple product as 1psi1: `psi(s, [(1,1,1)], [(1,1,1)], ...)`. Show Ramanujan's 1psi1 summation.
   - Notes: "The bilateral hypergeometric series sums over both positive and negative indices: ${}_r\psi_s = \sum_{n=-\infty}^{\infty}$. The Ramanujan ${}_1\psi_1$ summation is one of the most important bilateral identities."
   - See Also: Keep `phi`. Add `try_summation`, `tripleprod`.

3. `try_summation` (lines ~1840-~1960):
   - Examples: Show applying try_summation to a q-Gauss summable 2phi1 and getting the closed form. Show a case where it returns None (not summable by known formulas).
   - Notes: "Attempts six classical summation formulas in sequence: q-Gauss, q-Vandermonde (2 forms), q-Saalschutz, q-Kummer, and q-Dixon. Returns the formula name and closed-form product if successful."
   - See Also: Add `phi`, `heine1`, `heine2`, `heine3`, `q_gosper`.

4. `heine1` (lines ~1960-~2020):
   - Examples: Show Heine's first transformation of a 2phi1 with actual parameters, demonstrating the transformed form.
   - Notes: "Heine's first transformation: ${}_2\phi_1(a, b; c; q, z) = \frac{(b;q)_\infty(az;q)_\infty}{(c;q)_\infty(z;q)_\infty} \cdot {}_2\phi_1(c/b, z; az; q, b)$. Valid for $|z| < 1$, $|b| < 1$."
   - See Also: Add `heine2`, `heine3`, `phi`, `try_summation`.

5. `heine2` (lines ~2020-~2070):
   - Examples: Show Heine's second transformation with parameters.
   - Notes: "Heine's second transformation: ${}_2\phi_1(a, b; c; q, z) = \frac{(c/b;q)_\infty(bz;q)_\infty}{(c;q)_\infty(z;q)_\infty} \cdot {}_2\phi_1(abz/c, b; bz; q, c/b)$."
   - See Also: Add `heine1`, `heine3`, `phi`.

6. `heine3` (lines ~2070-~2113):
   - Examples: Show Heine's third transformation.
   - Notes: "Heine's third transformation (iteration of first and second)."
   - See Also: Add `heine1`, `heine2`, `phi`.

**GROUP 9: Identity Proving (2 functions)**

7. `prove_eta_id` (lines 2114-~2200):
   - Examples: Show proving a real eta-quotient identity, e.g., a classical modular equation or a Ramanujan-type eta identity. Provide the eta_left and eta_right dict format.
   - Notes: "Proves identities of the form $\prod_d \eta(d\tau)^{e_d} = \prod_d \eta(d\tau)^{f_d}$ by expanding both sides as formal power series and comparing coefficients up to a Sturm bound. The Sturm bound guarantees that equality of sufficiently many coefficients implies the identity holds for all $q$."
   - See Also: Add `etaq`, `etamake`, `search_identities`.

8. `search_identities` (lines ~2200-2295):
   - Examples: Show searching for identities among a set of eta-quotients with a given level.
   - Notes: "Builds a basis of eta-quotients at a given level and searches for linear dependencies, discovering new identities automatically."
   - See Also: Add `prove_eta_id`, `etaq`, `findhom`.

IMPORTANT: Do NOT change any Rust code outside of `///` doc-comment lines. Do NOT modify function signatures, implementations, or #[pyfunction] attributes.
  </action>
  <verify>
Run: `export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH" && PYO3_NO_PYTHON=1 cargo check -p qsym-python --features pyo3/abi3-py39`
Must compile without errors.
  </verify>
  <done>All 8 functions in Groups 8-9 have enriched docstrings with hypergeometric formulas, summation examples, and identity proving demonstrations. File compiles.</done>
</task>

<task type="auto">
  <name>Task 2: Enrich Group 10 docstrings (27 functions: 20 mock theta + 3 Appell-Lerch + 4 Bailey)</name>
  <files>crates/qsym-python/src/dsl.rs</files>
  <action>
Read lines 2296-3216 of dsl.rs. Enrich all 27 functions:

**GROUP 10a: Mock Theta Functions (20 functions)**

Use a consistent enrichment template for all 20 mock theta functions:

For EACH mock theta function, add:
1. **Examples**: Show the function call with actual first few coefficients as a comment, e.g., `# 1 + q + q^2 + q^3 + 2*q^4 + ...`
2. **Notes**: One paragraph identifying the order, who introduced it, and the key mathematical property. Use this template per order:
   - Third-order (f3, phi3, psi3, chi3, omega3, nu3, rho3): "One of Ramanujan's original third-order mock theta functions from his 1920 letter to Hardy. Third-order mock theta functions transform like modular forms of weight 1/2 up to a non-holomorphic correction (Zwegers, 2002)."
   - Fifth-order (f5_0, f5_1, phi5_0, phi5_1, psi5_0, psi5_1, chi5_0, chi5_1, F5_0, F5_1): "One of Ramanujan's fifth-order mock theta functions. The ten fifth-order functions split into two groups of five, related by Watson's (1936) analysis."
   - Seventh-order (F7_0, F7_1, F7_2): "Seventh-order mock theta function, first studied systematically by Selberg and later by Andrews (1986). Connected to affine Lie algebra characters."
3. **See Also**: Cross-reference other functions in the same order, plus `appell_lerch_m` (Appell-Lerch connection), `bailey_discover` (Bailey pair representation).

Specific enrichment per function:

Third-order (6+1 functions, lines 2310-~2530):
- `mock_theta_f3`: "$f(q) = \sum_{n \ge 0} q^{n^2}/(-q;q)_n^2$. The most famous mock theta function, appearing in Ramanujan's last letter."
- `mock_theta_phi3`: "$\phi(q) = \sum_{n \ge 0} q^{n^2}/(-q^2;q^2)_n$"
- `mock_theta_psi3`: "$\psi(q) = \sum_{n \ge 1} q^{n^2}/(q;q^2)_n$"
- `mock_theta_chi3`: "$\chi(q) = \sum_{n \ge 0} q^{n^2}(-q;q)_n/(-q^3;q^3)_n$"
- `mock_theta_omega3`: "$\omega(q) = \sum_{n \ge 0} q^{2n(n+1)}/(q;q^2)_{n+1}^2$"
- `mock_theta_nu3`: "$\nu(q) = \sum_{n \ge 0} q^{n(n+1)}/(-q;q^2)_{n+1}$"
- `mock_theta_rho3`: "$\rho(q) = \sum_{n \ge 0} q^{2n(n+1)}/(q;q^2)_{n+1}(1+q^{2n+1}+q^{2(2n+1)})$" (note the cyclotomic factor)

Fifth-order (10 functions, lines ~2530-~2800):
- For each, give the series definition in the Notes section and first few coefficients in Examples.
- `mock_theta_f5_0/f5_1`: $f_0(q)$ and $f_1(q)$
- `mock_theta_phi5_0/phi5_1`, `mock_theta_psi5_0/psi5_1`, `mock_theta_chi5_0/chi5_1`, `mock_theta_F5_0/F5_1`

Seventh-order (3 functions, lines ~2800-~2870):
- For each, give the series definition in Notes.
- `mock_theta_F7_0/F7_1/F7_2`

**GROUP 10b: Appell-Lerch Sums (3 functions, lines ~2870-~2900)**

4. `appell_lerch_m` (the bilateral Appell-Lerch sum):
   - Examples: Show computing $m(x, q, z)$ with specific parameters. Show connection to a mock theta function.
   - Notes: "The Appell-Lerch sum $m(x,q,z) = \frac{1}{j(z;q)} \sum_{n=-\infty}^{\infty} \frac{(-1)^n q^{n(n-1)/2} z^n}{1 - xzq^{n-1}}$ is central to the theory of mock theta functions (Zwegers, 2002). Many mock theta functions can be expressed as linear combinations of Appell-Lerch sums plus theta functions."
   - See Also: Add `universal_mock_theta_g2`, `universal_mock_theta_g3`, `mock_theta_f3`.

5. `universal_mock_theta_g2`:
   - Examples: Show g2 with parameters.
   - Notes: "The Zwegers $g_2$ function, a building block for the universal mock theta function. Used in the non-holomorphic completion of mock theta functions."
   - See Also: Add `universal_mock_theta_g3`, `appell_lerch_m`.

6. `universal_mock_theta_g3`:
   - Examples: Show g3 with parameters.
   - Notes: "The Zwegers $g_3$ function, companion to $g_2$."
   - See Also: Add `universal_mock_theta_g2`, `appell_lerch_m`.

**GROUP 10c: Bailey Machinery (4 functions, lines ~2900-3216)**

7. `bailey_weak_lemma` (lines 2900-2972):
   - Examples: Show weak Bailey lemma with rogers-ramanujan pair at a=1, demonstrating both sides match. Show connection to Rogers-Ramanujan identities.
   - Notes: "The weak Bailey lemma: if $(\alpha_n, \beta_n)$ is a Bailey pair relative to $a$, then $\sum_{n \ge 0} q^{n^2} a^n \beta_n = \frac{1}{(aq;q)_\infty} \sum_{n \ge 0} q^{n^2} a^n \alpha_n$. With the Rogers-Ramanujan pair at $a=1$, this yields the first Rogers-Ramanujan identity."
   - See Also: Keep existing. Add `mock_theta_f3` (mock theta functions arise from Bailey pairs).

8. `bailey_apply_lemma` (lines 2974-~3080):
   - Examples: Show applying lemma to unit pair, producing a derived pair.
   - Notes: "The (full) Bailey lemma transforms $(\alpha_n, \beta_n)$ relative to $a$ into a new pair $(\alpha'_n, \beta'_n)$ via parameters $b, c$. Iterating produces a Bailey chain."
   - See Also: Keep existing. Add `bailey_discover`.

9. `bailey_chain` (lines ~3080-~3160):
   - Examples: Show 2-step chain from unit pair producing Rogers-Ramanujan type identities.
   - Notes: "Iterates the Bailey lemma $k$ times from a seed pair, producing increasingly complex identities. The Rogers-Ramanujan identities arise as depth-1 chains from the unit pair."
   - See Also: Add `bailey_apply_lemma`, `bailey_weak_lemma`, `bailey_discover`.

10. `bailey_discover` (lines ~3160-3216):
    - Examples: Show discovering that a given series has a Bailey pair representation.
    - Notes: "Automated discovery: tests trivial equality, weak lemma matching, then chain search up to specified depth. Returns the construction path if found."
    - See Also: Add `bailey_chain`, `bailey_weak_lemma`, `bailey_apply_lemma`.

IMPORTANT: Do NOT change any Rust code outside of `///` doc-comment lines.
  </action>
  <verify>
Run: `export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH" && PYO3_NO_PYTHON=1 cargo check -p qsym-python --features pyo3/abi3-py39`
Must compile without errors.
  </verify>
  <done>All 27 functions in Group 10 have enriched docstrings. Mock theta functions have order-specific Notes citing Ramanujan/Watson/Andrews. Appell-Lerch functions have Zwegers context. Bailey functions demonstrate chain construction. File compiles.</done>
</task>

</tasks>

<verification>
- phi docstring has the full hypergeometric series definition in Notes
- try_summation example shows a successful summation with formula name
- All 20 mock theta functions have Notes sections with series definitions and historical attributions
- Appell-Lerch functions reference Zwegers (2002)
- Bailey functions show chain construction workflow
- All 35 functions have complete See Also cross-references
- File compiles with PYO3_NO_PYTHON=1 cargo check
</verification>

<success_criteria>
Groups 8-10 of dsl.rs have research-quality docstrings: hypergeometric series with DLMF references, mock theta functions with Ramanujan attributions and series definitions, Appell-Lerch with Zwegers theory context, Bailey machinery with chain construction examples. All cross-references complete.
</success_criteria>

<output>
After completion, create `.planning/phases/18-docstring-enrichment/18-03-SUMMARY.md`
</output>
