---
phase: 22-installation-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - INSTALL.md
autonomous: true
requirements:
  - INST-01
  - INST-02
  - INST-03
  - INST-04

must_haves:
  truths:
    - "A user on any supported platform can follow INSTALL.md from scratch to a working import q_kangaroo"
    - "A contributor on Cygwin/Windows can follow the build-from-source section to compile the Rust crate and run maturin develop"
    - "A contributor on Linux can follow the build-from-source section to compile and install from source"
    - "A user encountering GMP not found, wrong Rust target, or DLL loading error finds the solution in troubleshooting"
  artifacts:
    - path: "INSTALL.md"
      provides: "Complete installation documentation for all platforms and workflows"
      contains: "pip install q-kangaroo"
  key_links:
    - from: "INSTALL.md"
      to: "crates/qsym-python/pyproject.toml"
      via: "references same package name and Python version requirement"
      pattern: "q-kangaroo"
    - from: "INSTALL.md"
      to: "crates/qsym-python/python/q_kangaroo/__init__.py"
      via: "verification command imports from q_kangaroo"
      pattern: "from q_kangaroo import"
---

<objective>
Create INSTALL.md at the repository root with complete, self-contained installation instructions for every supported platform and workflow.

Purpose: Users and contributors need a single document that takes them from zero to a working q-Kangaroo installation without consulting any other file.
Output: INSTALL.md covering pip install, build-from-source (Cygwin/Windows + Linux), and troubleshooting.
</objective>

<execution_context>
@C:/Users/Owner/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Owner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@crates/qsym-python/pyproject.toml
@crates/qsym-python/python/q_kangaroo/__init__.py
@crates/qsym-core/Cargo.toml
@.github/workflows/ci.yml
@.github/workflows/release.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create INSTALL.md with pip install, build-from-source, and troubleshooting</name>
  <files>INSTALL.md</files>
  <action>
Create INSTALL.md at the repository root with the following sections. The document must be completely self-contained -- a reader should never need to leave this file to complete installation.

**Section 1: Quick Install (pip)**
- Command: `pip install q-kangaroo`
- State Python version requirement: 3.9 or later (from pyproject.toml requires-python = ">=3.9")
- State that pre-built wheels are available for Linux (x86_64, manylinux) and Windows (x86_64)
- State that GMP is bundled in wheels -- no system dependencies needed for pip install
- Include verification command: `python -c "from q_kangaroo import partition_count; assert partition_count(50) == 204226; print('q-Kangaroo is working!')"`

**Section 2: Build from Source -- Prerequisites (common)**
- Git, Python 3.9+, Rust (via rustup, stable toolchain), maturin (`pip install maturin`)
- Note: The Rust crate requires GMP (GNU Multiple Precision) library as a system dependency (gmp-mpfr-sys with use-system-libs feature)

**Section 3: Build from Source -- Linux (Ubuntu/Debian)**
Step-by-step:
1. Install system dependencies: `sudo apt-get update && sudo apt-get install -y build-essential libgmp-dev pkg-config`
   - For RHEL/CentOS/Fedora: `sudo yum install gcc gmp-devel pkgconfig` (or `dnf` equivalent)
2. Install Rust: `curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh` then `source "$HOME/.cargo/env"`
3. Clone: `git clone https://github.com/OWNER/q-kangaroo.git && cd q-kangaroo`
4. Create venv: `python3 -m venv .venv && source .venv/bin/activate`
5. Install maturin: `pip install maturin`
6. Build: `cd crates/qsym-python && PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1 maturin develop --release`
7. Verify: `python -c "from q_kangaroo import partition_count; assert partition_count(50) == 204226; print('Build successful!')"`
8. Run tests: `pip install pytest && pytest tests/ -v`

**Section 4: Build from Source -- Cygwin / Windows (MinGW)**
This is the most detailed section. Step-by-step:
1. Install Cygwin (https://cygwin.com) with packages: gcc-core, make, pkg-config, git, python3 (or use a standalone Python)
2. Install MSYS2 MinGW GMP: Download pre-built MSYS2 packages or use an existing MinGW-w64 installation. The project expects GMP at `C:\mingw64-gcc\mingw64\` by default. Need: `bin/libgmp-10.dll`, `lib/libgmp.a` (or `.dll.a`), `include/gmp.h`
3. Install Rust via rustup. CRITICAL: Must use the `x86_64-pc-windows-gnu` target, NOT `x86_64-pc-windows-msvc`.
   - `rustup default stable-x86_64-pc-windows-gnu`
   - Or if already installed: `rustup target add x86_64-pc-windows-gnu && rustup default stable-x86_64-pc-windows-gnu`
4. Set PATH in Cygwin shell:
   ```bash
   export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/$USER/.cargo/bin:$PATH"
   ```
   Document that this must be run in every new shell, or added to ~/.bashrc
5. Set environment variables for GMP discovery:
   ```bash
   export DEP_GMP_LIB_DIR="C:/mingw64-gcc/mingw64/lib"
   export DEP_GMP_INCLUDE_DIR="C:/mingw64-gcc/mingw64/include"
   export LIBRARY_PATH="C:/mingw64-gcc/mingw64/lib"
   export C_INCLUDE_PATH="C:/mingw64-gcc/mingw64/include"
   ```
6. Clone and build:
   ```bash
   git clone https://github.com/OWNER/q-kangaroo.git
   cd q-kangaroo/crates/qsym-python
   python -m venv .venv
   source .venv/Scripts/activate  # Note: Scripts on Windows, not bin
   pip install maturin
   PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1 maturin develop --release
   ```
7. Verify same as Linux section
8. Note about DLL loading: At import time, q_kangaroo looks for libgmp-10.dll in three places (in order): (a) bundled in the package directory, (b) path from MINGW_BIN environment variable, (c) hardcoded C:\mingw64-gcc\mingw64\bin. For development builds, ensure MinGW bin is in one of these locations.

**Section 5: Troubleshooting**
Each problem as a subsection with: Symptom, Cause, Fix.

1. **GMP not found during build**
   - Symptom: `error: failed to run custom build command for gmp-mpfr-sys` or `ld: cannot find -lgmp`
   - Cause: GMP development headers/libraries not installed or not in search path
   - Fix (Linux): `sudo apt-get install libgmp-dev` or equivalent
   - Fix (Windows): Set `LIBRARY_PATH` and `C_INCLUDE_PATH` environment variables to point to MinGW GMP installation (see build-from-source section above)

2. **Wrong Rust target on Windows**
   - Symptom: Linker errors mentioning MSVC, `link.exe`, or `VCRUNTIME`
   - Cause: Rust is using the MSVC toolchain instead of GNU
   - Fix: `rustup default stable-x86_64-pc-windows-gnu` -- the project requires the GNU target because it links against MinGW-built GMP

3. **cargo/rustc not found in Cygwin**
   - Symptom: `cargo: command not found` or `rustc: command not found`
   - Cause: Cargo bin directory not in Cygwin PATH
   - Fix: `export PATH="/c/Users/$USER/.cargo/bin:$PATH"` (add to ~/.bashrc for persistence)

4. **DLL loading error at import time**
   - Symptom: `ImportError: DLL load failed while importing _q_kangaroo` or `libgmp-10.dll not found`
   - Cause: Python cannot find the GMP shared library at runtime
   - Fix: Either (a) set `MINGW_BIN` environment variable to your MinGW bin directory, (b) ensure `C:\mingw64-gcc\mingw64\bin` exists with libgmp-10.dll, or (c) copy libgmp-10.dll into the q_kangaroo package directory

5. **Python version too old**
   - Symptom: `ERROR: q-kangaroo requires Python >=3.9` or syntax errors on import
   - Cause: Python version is 3.8 or older
   - Fix: Install Python 3.9 or later

6. **maturin not installed or build fails**
   - Symptom: `maturin: command not found` or `ModuleNotFoundError: No module named 'maturin'`
   - Cause: maturin not installed in current Python environment
   - Fix: `pip install maturin` (must be in the same venv where you want q-kangaroo)

Use Markdown formatting with clear headers. Use fenced code blocks with `bash` language tag. Keep the tone direct and practical -- no preamble, just what to do.
  </action>
  <verify>
Verify the file exists and contains all required sections:
- `grep -c "pip install q-kangaroo" INSTALL.md` returns at least 1
- `grep -c "Cygwin" INSTALL.md` returns at least 1
- `grep -c "Ubuntu" INSTALL.md` or `grep -c "apt-get" INSTALL.md` returns at least 1
- `grep -c "Troubleshooting" INSTALL.md` returns at least 1
- `grep -c "libgmp" INSTALL.md` returns at least 1
- `grep -c "x86_64-pc-windows-gnu" INSTALL.md` returns at least 1
- `grep -c "partition_count" INSTALL.md` returns at least 1 (verification command)
  </verify>
  <done>
INSTALL.md exists at repo root with: (1) pip install quick start with verification command, (2) Linux build-from-source with apt-get/yum instructions, (3) Cygwin/Windows build-from-source with MinGW GMP and correct Rust target, (4) troubleshooting section covering GMP not found, wrong Rust target, PATH issues, DLL loading errors, Python version, and maturin issues. A reader can follow any path start-to-finish without consulting another document.
  </done>
</task>

</tasks>

<verification>
- INSTALL.md exists at repository root
- Document has pip install section with verification command
- Document has Linux build-from-source section with apt-get and yum
- Document has Cygwin/Windows build-from-source section with MinGW GMP setup
- Document has troubleshooting section with 6 common issues
- All commands are copy-pasteable (no placeholder paths that the user must guess)
- Python version requirement matches pyproject.toml (>=3.9)
- Rust target specified as x86_64-pc-windows-gnu for Windows
- DLL loading behavior documented (3-tier fallback)
</verification>

<success_criteria>
- INSTALL.md covers INST-01 (pip install), INST-02 (Cygwin/Windows build), INST-03 (Linux build), INST-04 (troubleshooting)
- A fresh reader can follow any installation path without external references
- All environment variables, PATH settings, and commands are explicit
</success_criteria>

<output>
After completion, create `.planning/phases/22-installation-documentation/22-01-SUMMARY.md`
</output>
