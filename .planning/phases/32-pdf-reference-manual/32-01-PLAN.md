---
phase: 32-pdf-reference-manual
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - manual/main.typ
  - manual/template.typ
  - manual/chapters/00-title.typ
  - manual/chapters/01-quick-start.typ
  - manual/chapters/02-installation.typ
  - manual/chapters/03-cli-usage.typ
  - manual/chapters/04-expression-language.typ
autonomous: true
requirements: [DOC-02]

must_haves:
  truths:
    - "manual/ directory exists with main.typ as compilation entry point"
    - "template.typ provides func-entry and repl-example templates used by all function chapters"
    - "Quick Start chapter teaches install, first expression, first script in 2-3 pages"
    - "CLI Usage chapter documents all 6 flags, 3 execution modes, 7 exit codes, and 7 session commands"
    - "Expression Language chapter documents all operators, types, keywords, and syntax"
  artifacts:
    - path: "manual/main.typ"
      provides: "Master document with page setup, font config, includes for all 15 chapters"
      contains: "#include"
    - path: "manual/template.typ"
      provides: "func-entry template, repl-example template, chapter styling"
      contains: "func-entry"
    - path: "manual/chapters/03-cli-usage.typ"
      provides: "CLI flags, modes, exit codes, session commands"
      contains: "exit"
    - path: "manual/chapters/04-expression-language.typ"
      provides: "Operators, types, q keyword, infinity, assignment, lists"
      contains: "operator"
  key_links:
    - from: "manual/main.typ"
      to: "manual/template.typ"
      via: "#import"
      pattern: 'import.*template'
    - from: "manual/main.typ"
      to: "manual/chapters/*.typ"
      via: "#include"
      pattern: '#include.*chapters'
---

<objective>
Create the Typst project infrastructure and all introductory chapters for the q-Kangaroo PDF reference manual.

Purpose: Establish the shared template, page layout, fonts, and master document structure that all subsequent plans depend on. Write the 4 introductory chapters (Quick Start, Installation, CLI Usage, Expression Language) plus the title page.

Output: manual/ directory with main.typ, template.typ, and chapters 00-04.
</objective>

<execution_context>
@C:/Users/Owner/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Owner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/32-pdf-reference-manual/32-RESEARCH.md
@crates/qsym-cli/src/main.rs
@crates/qsym-cli/src/script.rs
@crates/qsym-cli/src/commands.rs
@crates/qsym-cli/src/token.rs
@crates/qsym-cli/src/help.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create manual/ directory structure, main.typ, and template.typ</name>
  <files>
    manual/main.typ
    manual/template.typ
    manual/chapters/00-title.typ
  </files>
  <action>
Create `manual/` directory with `chapters/` subdirectory.

**template.typ** -- shared styling and reusable components:
- `func-entry` template function with parameters: name, signature, description, math-def (optional content), params (array of (name, type, description) triples), examples (array of (input, output) strings), edge-cases (array of strings), related (array of strings). Each entry:
  - Level 3 heading with function name
  - `#index-main[name]` call for back-of-book index (using in-dexter)
  - Signature in monospace block (gray background, 8pt inset, 4pt radius, full width)
  - Description paragraph
  - Mathematical definition block (if provided) with "Mathematical Definition" bold label
  - Parameters table (3 columns: Name, Type, Description) -- only if params non-empty
  - Examples in REPL transcript style -- only if examples non-empty
  - Edge cases as bullet list -- only if non-empty
  - Related functions as inline comma-separated list -- only if non-empty
- `repl` helper function: takes input string and output string, renders in monospace block with `q> ` prompt prefix in gray
- `repl-block` helper: takes a single raw string for multi-line REPL transcripts
- Chapter heading style: use Typst show rules for consistent chapter headings

**main.typ** -- master document:
- `#import "@preview/in-dexter:0.7.2": *`
- `#import "template.typ": *`
- Document metadata: title "q-Kangaroo Reference Manual", author "q-Kangaroo Contributors"
- Page setup: US Letter, 1in margins all sides
- Text: New Computer Modern 11pt (body), DejaVu Sans Mono 9pt (code via template)
- Heading numbering: "1.1"
- DO NOT set equation numbering globally (most equations are display-only, not numbered)
- Include title page (chapter 00)
- Table of contents via `#outline(depth: 3, indent: auto)` then `#pagebreak()`
- Include all 15 chapter files (01 through 15) -- chapters 05-15 will be empty stubs initially created by later plans
- Final `#pagebreak()` then `#make-index(title: [Index])` for back-of-book index

**chapters/00-title.typ** -- title page:
- Large centered title "q-Kangaroo Reference Manual"
- Subtitle "Symbolic q-Series Computation"
- Version from a Typst variable (set `#let version = "0.9.0"` in main.typ or template.typ)
- Brief description: "A comprehensive reference for all 81 built-in functions, the expression language, CLI usage, and worked examples."
- `#pagebreak()`

Font note: New Computer Modern and DejaVu Sans Mono are available in Typst's bundled font set -- no external fonts needed.
  </action>
  <verify>
Verify files exist and contain expected structure:
- `manual/main.typ` contains `#import`, `#include`, `#outline`, `#make-index`
- `manual/template.typ` contains `func-entry` function definition and `repl` function
- `manual/chapters/00-title.typ` contains title text
  </verify>
  <done>
manual/ directory exists with main.typ (master document with all includes), template.typ (func-entry and repl templates), and 00-title.typ (title page). The project is ready for chapter content.
  </done>
</task>

<task type="auto">
  <name>Task 2: Write introductory chapters 01-04</name>
  <files>
    manual/chapters/01-quick-start.typ
    manual/chapters/02-installation.typ
    manual/chapters/03-cli-usage.typ
    manual/chapters/04-expression-language.typ
  </files>
  <action>
**chapters/01-quick-start.typ** -- Quick Start tutorial (2-3 pages):
- Chapter heading "Quick Start"
- Section "Installing q-Kangaroo": Brief pointer to Chapter 2 for full details, one-liner: download binary from GitHub Releases
- Section "Your First Expression": Show launching REPL (`q-kangaroo`), evaluating `partition_gf(10)`, explain q-series output format, show `partition_count(100)` for integer result
- Section "Exploring q-Series": Show variable assignment (`f := aqprod(1,1,1,infinity,20)`), show using `%` for last result, show `prodmake(%, 10)` to analyze
- Section "Your First Script": Create a file `example.qk` with 3-4 lines (comments with `#`, variable assignments, expressions), run with `q-kangaroo example.qk`
- Section "Getting Help": `help` command, `help aqprod`, `--help` flag
- Use `repl()` template for all examples. Show realistic output matching actual function behavior.
- Index entries: "Quick Start", "installation"

**chapters/02-installation.typ** -- Installation (1-2 pages):
- Chapter heading "Installation"
- Section "Pre-built Binaries": Download from GitHub Releases page, extract archive, add to PATH. Note: single static binary, no dependencies.
- Section "Linux": `tar xzf q-kangaroo-linux-x86_64.tar.gz`, `chmod +x q-kangaroo`, move to PATH
- Section "Windows": Extract zip, optionally add directory to PATH
- Section "Building from Source": Requires Rust 1.85+, C compiler (for GMP), `cargo build --release -p qsym-cli`
- Section "Python API": Separate package `pip install q-kangaroo` for Python bindings
- Section "Verifying Installation": `q-kangaroo --version`
- Index entries: "installation", "building from source", "Python API"

**chapters/03-cli-usage.typ** -- CLI Usage (3-4 pages):
- Chapter heading "Command-Line Interface"
- Section "Synopsis": `q-kangaroo [OPTIONS] [FILE]`, `q-kangaroo -c EXPRESSION`, `command | q-kangaroo`
- Section "Options": Table with all 6 flags from main.rs print_usage(): `-h/--help`, `-V/--version`, `-c EXPRESSION`, `-q/--quiet`, `-v/--verbose`, `--` end-of-options
- Section "Execution Modes": Interactive REPL (default when TTY), Script execution (positional FILE arg), Expression evaluation (-c), Piped input (stdin not TTY). Brief description and example of each.
- Section "Session Commands": Table documenting all 7 commands from commands.rs: help, set precision, clear, quit/exit, latex, save, read. Include syntax and brief description.
- Section "Exit Codes": Table with all 7 exit codes from script.rs: 0 (success), 1 (eval error), 2 (usage error), 65 (parse error), 66 (file not found), 70 (panic), 74 (I/O error). Brief explanation of each. Summary-level per user decision.
- Section "Error Messages": Brief explanation that REPL shows errors and continues, scripts stop on first error with `filename:line:` prefix. NOT a comprehensive error catalog -- just the behavior model.
- Index entries: "command-line interface", "flags", "exit codes", "session commands", "interactive mode", "script mode"

**chapters/04-expression-language.typ** -- Expression Language (3-4 pages):
- Chapter heading "Expression Language"
- Section "Overview": q-Kangaroo uses a Maple-inspired expression language for all input.
- Section "Literals": Integer literals (arbitrary precision), the `q` indeterminate (reserved keyword), `infinity` keyword, string literals (for filenames in read/save)
- Section "Variables and Assignment": `:=` operator, `%` last-result reference, variable naming rules (alphanumeric + underscore, must start with letter)
- Section "Arithmetic Operators": Table with +, -, *, /, ^ and their meaning on series/integers/rationals. Note: ^ requires integer exponent for series.
- Section "Lists": `[a, b, c]` syntax, used as arguments to findlincombo, phi/psi upper/lower lists, etc.
- Section "Function Calls": `name(arg1, arg2, ...)` syntax, 81 built-in functions (see Chapters 5-12)
- Section "Statement Separators": `;` prints result, `:` suppresses output, implicit print at end of line
- Section "Comments": `#` line comments (in scripts)
- Section "Value Types": Brief table of the 10 value types from eval.rs Value enum: Integer, Rational, Series, String, List, Map, Boolean, Tuple, Null, ProductRepr. Describe what operations produce each.
- Index entries: "expression language", "operators", "variables", "assignment", "lists", "comments", "value types"
  </action>
  <verify>
Verify all 4 chapter files exist and contain expected sections:
- 01-quick-start.typ contains "Quick Start", "First Expression", "First Script"
- 02-installation.typ contains "Installation", "Pre-built Binaries", "Building from Source"
- 03-cli-usage.typ contains "Command-Line Interface", "Options", "Exit Codes", "Session Commands"
- 04-expression-language.typ contains "Expression Language", "Operators", "Variables", "Value Types"
  </verify>
  <done>
All 4 introductory chapters are complete with realistic content, REPL examples, tables, and index entries. CLI chapter covers all flags, modes, exit codes, and session commands (DOC-02). Expression language chapter documents all operators and types.
  </done>
</task>

</tasks>

<verification>
- manual/main.typ exists and includes all 15 chapters
- manual/template.typ defines func-entry and repl templates
- Chapters 00-04 have substantive content matching source code
- CLI chapter documents all flags from main.rs print_usage()
- CLI chapter documents all 7 exit codes from script.rs
- CLI chapter documents all 7 session commands from commands.rs
- Expression language chapter covers all token types from token.rs
</verification>

<success_criteria>
- manual/ directory with main.typ, template.typ, and chapters/00-04.typ
- Template provides func-entry and repl components ready for function chapters
- CLI chapter is complete per DOC-02 requirements
- Expression language chapter documents the full grammar
</success_criteria>

<output>
After completion, create `.planning/phases/32-pdf-reference-manual/32-01-SUMMARY.md`
</output>
