---
phase: 51-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crates/qsym-cli/src/help.rs
  - crates/qsym-cli/src/repl.rs
autonomous: true
requirements: [DOC-HELP, DOC-COMPLETION]

must_haves:
  truths:
    - "?ditto displays help text with signature, description, and example"
    - "?lambda displays help text explaining arrow syntax with example"
    - "?radsimp displays help text with signature, description, and example"
    - "?jac2series help shows both 2-arg and 3-arg signatures"
    - "?quinprod help shows prodid and seriesid modes"
    - "?subs help shows indexed variable substitution X[i]=val"
    - "Tab completing 'rad' offers 'radsimp('"
    - "Tab completing 'mi' offers 'min('"
    - "Tab completing 'ma' offers 'max('"
    - "All CLI tests pass including updated count assertions"
  artifacts:
    - path: "crates/qsym-cli/src/help.rs"
      provides: "radsimp FuncHelp entry, ditto/lambda match arms, updated jac2series/quinprod/subs entries, updated general_help(), updated test assertions"
      contains: "radsimp"
    - path: "crates/qsym-cli/src/repl.rs"
      provides: "min, max, radsimp, read in canonical_function_names(), updated count assertion"
      contains: "radsimp"
  key_links:
    - from: "crates/qsym-cli/src/repl.rs"
      to: "crates/qsym-cli/src/eval.rs"
      via: "canonical_function_names must match ALL_FUNCTION_NAMES"
      pattern: "canonical_function_names.*101"
    - from: "crates/qsym-cli/src/help.rs"
      to: "crates/qsym-cli/src/help.rs"
      via: "FUNC_HELP count matches test assertion"
      pattern: "FUNC_HELP.len.*98"
---

<objective>
Add all v4.0 help entries and update tab completion to include all new and previously missing function names.

Purpose: Users can type ?ditto, ?lambda, ?radsimp and get full help text with examples from qmaple.pdf. Updated existing entries for jac2series, quinprod, and subs reflect v4.0 signatures. Tab completion includes min, max, radsimp, and read.
Output: Updated help.rs and repl.rs with all entries, passing all tests.
</objective>

<execution_context>
@C:/Users/Owner/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Owner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/51-documentation/51-RESEARCH.md
@crates/qsym-cli/src/help.rs
@crates/qsym-cli/src/repl.rs
@crates/qsym-cli/src/eval.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add and update help entries in help.rs</name>
  <files>crates/qsym-cli/src/help.rs</files>
  <action>
  Three categories of changes in help.rs:

  **A. New FuncHelp entry for radsimp** (add to FUNC_HELP array after the "subs" entry, in a new "Group 13: Simplification" section):
  ```rust
  // Group 13: Simplification (1)
  FuncHelp {
      name: "radsimp",
      signature: "radsimp(expr)",
      description: "Simplify a rational expression involving series quotients.\n  Currently acts as the identity function, returning its input unchanged.\n  Provided for compatibility where radsimp() is used after series division.",
      example: "q> f := theta3(q, 20)^2: radsimp(f)",
      example_output: "4*q^16 + 4*q^9 + 4*q^4 + 4*q + 1 + O(q^20)",
  },
  ```
  No Maple references per user decision. This makes FUNC_HELP.len() = 98.

  Also add a FuncHelp entry for "read":
  ```rust
  // Group 14: Script Loading (1)
  FuncHelp {
      name: "read",
      signature: "read(\"filename.qk\")",
      description: "Load and execute a q-Kangaroo script file.\n  The file is executed as if its contents were typed at the prompt.\n  Variables and procedures defined in the script persist in the session.",
      example: "q> read(\"examples/rr.qk\")",
      example_output: "(loads and executes the script)",
  },
  ```
  This makes FUNC_HELP.len() = 99. (read was in ALL_FUNCTION_NAMES but had no help entry.)

  **B. New language construct match arms** (add before the `_ => {}` fallback in function_help()):

  For ditto:
  ```rust
  "ditto" | "\"" => return Some(String::from(
      "\" (ditto operator)\n\n\
       \x20 The double-quote character \" refers to the last printed result.\n\
       \x20 It is equivalent to % but follows Garvan's q-series convention.\n\n\
       \x20 Examples:\n\
       \x20   q> aqprod(q, q, 5)\n\
       \x20   -q^15 + q^14 + q^13 - q^10 - q^9 - q^8 + q^7 + q^6 + q^5 - q^2 - q + 1\n\
       \x20   q> etamake(\", q, 20)\n\
       \x20   eta(tau)\n\n\
       \x20 Edge case: \" always refers to the most recently printed value,\n\
       \x20 even when multiple expressions are separated by semicolons.\n\n\
       \x20 See also: %"
  )),
  ```

  For lambda/arrow:
  ```rust
  "lambda" | "arrow" | "->" => return Some(String::from(
      "-> (arrow / lambda operator)\n\n\
       \x20 Define an anonymous function: var -> expression\n\
       \x20 Typically used with := for named functions.\n\n\
       \x20 Examples:\n\
       \x20   q> F := q -> theta3(q, 500) / theta3(q^5, 100)\n\
       \x20   q> series(F(q), q, 20)\n\
       \x20   2*q^15 + 2*q^10 + q^5 + 2*q^4 + 2*q^3 + 2*q + 1 + O(q^20)\n\n\
       \x20   q> G := n -> n*(3*n - 1)/2\n\
       \x20   q> G(5)\n\
       \x20   35\n\n\
       \x20 The arrow desugars into a procedure with one parameter.\n\n\
       \x20 See also: proc"
  )),
  ```

  **C. Update existing FuncHelp entries:**

  Update jac2series signature and description to show both 2-arg and 3-arg forms:
  - signature: `"jac2series(JP, T) or jac2series(JP, q, T)"`
  - description: Add note that 2-arg form `jac2series(JP, T)` uses the default variable q, which is equivalent to `jac2series(JP, q, T)`.

  Update quinprod signature and description to show prodid/seriesid modes:
  - signature: `"quinprod(z, q, T) or quinprod(z, q, \"prodid\") or quinprod(z, q, \"seriesid\")"`
  - description: Add that when the third argument is the string "prodid", displays the quintuple product identity in product form. When "seriesid", displays in series form.

  Update subs description to mention indexed variable substitution:
  - description: Add note about indexed variables: `subs(X[1]=q, X[2]=q^2, expr)` substitutes indexed variables in expressions (useful with findnonhom output).

  **D. Update general_help():**

  Add "radsimp" under a new "Simplification:" category after "Polynomial Operations:":
  ```
  Simplification:
    radsimp        - simplify rational series expression
  ```

  Add "read" to the Commands section:
  ```
    read filename     - load and execute a script file
  ```

  Add ditto and arrow to the existing sections. Add to Commands section:
  ```
    \"                - refer to the last printed result (ditto)
  ```
  Add to Scripting section after RETURN:
  ```
    ->             - arrow / lambda: F := x -> expr
  ```

  **E. Update test assertions:**

  1. `func_help_count_matches_canonical`: Change `97` to `99` (added radsimp + read).
  2. `every_canonical_function_has_help_entry`: Add `"radsimp"` and `"read"` to the canonical vector. Update the vector length assertion from `97` to `101` (adding min, max, radsimp, read to match repl.rs canonical list).

  Wait -- this test checks function_help() returns Some for each name. min and max already have FuncHelp entries. The test hardcodes a list of 97 names that must all have help. We need to add radsimp, read, min, max to this list = 101 names total. The assertion `canonical.len() == 97` becomes `canonical.len() == 101`.

  3. Add new tests:
  - `function_help_ditto_returns_some`: assert function_help("ditto").is_some() and contains "ditto"
  - `function_help_lambda_returns_some`: assert function_help("lambda").is_some() and contains "arrow"
  - `function_help_radsimp_returns_some`: assert function_help("radsimp").is_some() and contains "radsimp"
  - `function_help_read_returns_some`: assert function_help("read").is_some() and contains "read"
  - `general_help_contains_radsimp`: assert general_help().contains("radsimp")
  - `general_help_contains_ditto_reference`: assert general_help().contains("ditto") or contains("\"")

  IMPORTANT: Do NOT reference Maple in any help text (user locked decision). All entries must be self-contained.
  </action>
  <verify>
  ```bash
  export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH"
  cd C:/cygwin64/home/Owner/Kangaroo
  cargo test -p qsym-cli -- help:: --lib 2>&1 | tail -20
  ```
  All help tests pass including updated count assertions.
  </verify>
  <done>
  - FUNC_HELP has 99 entries (97 + radsimp + read)
  - function_help("ditto"), function_help("lambda"), function_help("radsimp"), function_help("read") all return Some
  - jac2series help shows 2-arg form, quinprod help shows prodid/seriesid, subs help shows indexed vars
  - general_help() includes Simplification category with radsimp, ditto reference, arrow in Scripting
  - All help:: tests pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Update tab completion in repl.rs</name>
  <files>crates/qsym-cli/src/repl.rs</files>
  <action>
  Update canonical_function_names() to add the 4 missing names that are in ALL_FUNCTION_NAMES but not yet in the completion list:

  1. Add `"min", "max"` to Group P (Number Theory), changing it from 2 to 4 entries:
  ```rust
  // Group P: Number Theory (4)
  "floor", "legendre", "min", "max",
  ```

  2. Add `"radsimp"` as a new Group T (Simplification):
  ```rust
  // Group T: Simplification (1)
  "radsimp",
  ```

  3. Add `"read"` to Group M (Script loading) or near Group 9 (Variable Management):
  ```rust
  // Group M: Script Loading (1)
  "read",
  ```

  This brings canonical_function_names().len() from 97 to 101.

  4. Update the `canonical_function_count` test assertion from 97 to 101:
  ```rust
  assert_eq!(
      names.len(),
      101,
      "expected 101 canonical function names, got {}",
      names.len()
  );
  ```

  5. Update the doc comment on canonical_function_names from "All 91 canonical function names" to "All 101 canonical function names".

  6. Run no_duplicate_function_names test to verify no duplicates were introduced.
  </action>
  <verify>
  ```bash
  export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH"
  cd C:/cygwin64/home/Owner/Kangaroo
  cargo test -p qsym-cli -- canonical_function_count --lib 2>&1
  cargo test -p qsym-cli -- no_duplicate_function_names --lib 2>&1
  cargo test -p qsym-cli --lib 2>&1 | tail -5
  ```
  All repl tests pass, canonical count is 101, no duplicates.
  </verify>
  <done>
  - canonical_function_names() returns 101 names including min, max, radsimp, read
  - Tab completing "rad" offers "radsimp("
  - Tab completing "mi" offers "min("
  - Tab completing "ma" offers "max("
  - Tab completing "rea" offers "read("
  - All repl:: tests pass with no duplicates
  - All CLI tests pass (cargo test -p qsym-cli --lib)
  </done>
</task>

</tasks>

<verification>
```bash
export PATH="/c/mingw64-gcc/mingw64/bin:/c/cygwin64/bin:/c/Users/Owner/.cargo/bin:$PATH"
cd C:/cygwin64/home/Owner/Kangaroo
# All CLI tests pass
cargo test -p qsym-cli --lib 2>&1 | tail -10
# Spot-check help entries via binary
cargo run -p qsym-cli -- -c '?ditto' 2>&1 | head -5
cargo run -p qsym-cli -- -c '?radsimp' 2>&1 | head -5
cargo run -p qsym-cli -- -c '?lambda' 2>&1 | head -5
```
</verification>

<success_criteria>
- All 99 FUNC_HELP entries present (97 original + radsimp + read)
- 5 language construct match arms (for, proc, if, ditto, lambda)
- ?ditto, ?lambda, ?radsimp, ?read all display help text with examples
- Updated existing entries: jac2series (2-arg), quinprod (prodid/seriesid), subs (indexed vars)
- general_help() lists radsimp, ditto, arrow
- canonical_function_names() has 101 entries matching ALL_FUNCTION_NAMES
- All cargo test -p qsym-cli --lib tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/51-documentation/51-01-SUMMARY.md`
</output>
